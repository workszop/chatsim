<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Symulator ParadygmatÃ³w ChatbotÃ³w</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configure MathJax
        window.MathJax = {
          tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']] // Define inline math delimiters
          },
          svg: {
            fontCache: 'global'
          }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
    <style>
        /* Custom CSS for typing animation */
        .typing {
            border-right: 2px solid;
            animation: blink .7s steps(1) infinite;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        @keyframes blink {
            50% { border-color: transparent; }
        }
        /* Style for the details summary (accordion trigger) */
        summary { cursor: pointer; }
        /* Ensure icons align nicely with text */
        svg.inline-icon {
            display: inline-block;
            vertical-align: middle;
            margin-right: 0.5rem;
        }
        /* Ensure body takes full height for footer positioning */
        html, body {
            height: 100%;
        }
        body {
            display: flex;
            flex-direction: column;
        }
        main {
            flex-grow: 1; /* Allow main content to fill space */
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">

    <header class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white shadow-md sticky top-0 z-10">
        <div class="container mx-auto px-4 py-4">
            <h1 class="text-3xl font-bold">Symulator ParadygmatÃ³w ChatbotÃ³w</h1>
            <p class="text-indigo-100 mt-1 text-sm">
                Odkryj, jak rÃ³Å¼ne podejÅ›cia chatbotÃ³w radzÄ… sobie z tym samym zapytaniem.
            </p>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-6 lg:p-8 flex flex-col items-center">

        <p class="text-center text-gray-600 mb-6 max-w-3xl">
            PorÃ³wnaj standardowy DuÅ¼y Model JÄ™zykowy (LLM), model wykorzystujÄ…cy wewnÄ™trzne rozumowanie oraz model uÅ¼ywajÄ…cy Generowania Wspomaganego Wyszukiwaniem (RAG) z dostÄ™pem do okreÅ›lonej bazy wiedzy (np. dokumenty wewnÄ™trzne).
        </p>

        <div class="w-full max-w-4xl flex flex-col gap-2 mb-6 bg-white p-5 rounded-lg shadow-md border border-gray-200">
            <label for="promptSelect" class="text-sm font-medium text-gray-700">Wybierz przykÅ‚adowe zapytanie:</label>
            <select id="promptSelect" class="p-2 rounded border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out"></select>
            <div class="flex flex-col sm:flex-row gap-2 mt-2">
                <input id="promptInput" class="flex-1 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out" placeholder="Lub wpisz wÅ‚asne pytanie...">
                <button id="sendBtn" class="bg-blue-600 text-white px-6 py-2 rounded font-semibold hover:bg-blue-700 active:bg-blue-800 transition-colors duration-200 shadow-sm flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
                    </svg>
                    WyÅ›lij
                </button>
            </div>
        </div>

        <div id="alert" class="hidden text-red-700 mb-4 font-medium p-3 bg-red-100 border border-red-300 rounded w-full max-w-4xl text-sm"></div>

        <div id="chatContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5 w-full max-w-7xl">
            </div>

    </main>

    <footer class="bg-gray-800 text-gray-300 text-center p-4 mt-8 shadow-inner">
        <div class="container mx-auto text-sm">
            &copy; 2024 Symulator ChatbotÃ³w. Wszelkie prawa zastrzeÅ¼one.
        </div>
    </footer>

    <script id="questionData" type="application/json">
    {
      "questions": [
        {
          "prompt": "WyjaÅ›nij proces fotosyntezy",
          "llm": {
            "text": "Fotosynteza to proces biologiczny, w ktÃ³rym roÅ›liny, glony i niektÃ³re bakterie przeksztaÅ‚cajÄ… energiÄ™ Å›wietlnÄ…, wodÄ™ i CO2 w glukozÄ™ (pokarm) oraz tlen. Jest kluczowa dla Å¼ycia.",
            "tokens": 30,
            "latencyMs": 400,
            "costUsd": 0.00030
          },
          "reasoning": {
            "text": "Aby logicznie wyjaÅ›niÄ‡ fotosyntezÄ™:\nSkÅ‚ada siÄ™ z dwÃ³ch gÅ‚Ã³wnych etapÃ³w.\n1.  **Reakcje Å›wietlne:** PrzechwytujÄ… energiÄ™ sÅ‚onecznÄ… za pomocÄ… chlorofilu, produkujÄ…c ATP i NADPH.\n2.  **Cykl Calvina:** Wykorzystuje ATP i NADPH do przeksztaÅ‚cenia CO2 w cukry (glukozÄ™).\nTa sekwencja przeksztaÅ‚ca energiÄ™ Å›wietlnÄ… w energiÄ™ chemicznÄ….",
            "tokens": 55,
            "latencyMs": 600,
            "costUsd": 0.00055,
            "reasoningTrace": [
              "Cel: WyjaÅ›niÄ‡ fotosyntezÄ™",
              "PodziaÅ‚: ZidentyfikowaÄ‡ kluczowe komponenty (wejÅ›cia, proces, wyjÅ›cia)",
              "SzczegÃ³Å‚y procesu: PodzieliÄ‡ na gÅ‚Ã³wne etapy (Reakcje Å›wietlne, Cykl Calvina)",
              "Podsumowanie etapu 1: Energia Å›wietlna -> NoÅ›niki chemiczne (ATP, NADPH)",
              "Podsumowanie etapu 2: NoÅ›niki chemiczne + CO2 -> Cukry",
              "Synteza: PoÅ‚Ä…czyÄ‡ podsumowania etapÃ³w w spÃ³jne wyjaÅ›nienie przeksztaÅ‚cenia energii."
            ]
          },
          "rag": {
            "text": "Sprawdzam wewnÄ™trznÄ… bazÄ™ wiedzy biologicznej:\nFotosynteza zachodzi w chloroplastach [Ref. dok.: BioKB-123]. Proces przebiega wedÅ‚ug rÃ³wnania $6CO_2 + 6H_2O \\xrightarrow{ÅšwiatÅ‚o} C_6H_{12}O_6 + 6O_2$ [Ref. dok.: SciencePrimer-Chap4]. Jest fundamentalna dla przepÅ‚ywu energii w ekosystemie.",
            "tokens": 48,
            "latencyMs": 780,
            "costUsd": 0.00070,
            "citations": [
              {
                "title": "Dokument wewnÄ™trzny: BioKB-123",
                "snippet": "Sekcja dotyczÄ…ca organelli komÃ³rkowych opisuje funkcjÄ™ chloroplastÃ³w w fotosyntezie...",
                "url": "#"
              },
               {
                "title": "Dokument wewnÄ™trzny: SciencePrimer-Chap4",
                "snippet": "RozdziaÅ‚ 4 szczegÃ³Å‚owo opisuje rÃ³wnanie chemiczne i zasady przeksztaÅ‚cania energii...",
                "url": "#"
              }
            ]
          },
          "agent": {
            "text": "Fotosynteza to proces konwersji energii Å›wietlnej w chemicznÄ…, zachodzÄ…cy w chloroplastach. SkÅ‚ada siÄ™ z dwÃ³ch etapÃ³w: **reakcji Å›wietlnych** (produkcja ATP i NADPH) oraz **cyklu Calvina** (synteza glukozy z COâ‚‚). RÃ³wnanie: $6CO_2 + 6H_2O \\xrightarrow{ÅšwiatÅ‚o} C_6H_{12}O_6 + 6O_2$. EfektywnoÅ›Ä‡ energetyczna wynosi 3-6% w optymalnych warunkach.",
            "tokens": 142,
            "latencyMs": 1850,
            "costUsd": 0.00155,
            "agentTrace": [
              {"type": "plan", "content": "Strategia: 1) Pobierz definicjÄ™ z bazy wiedzy, 2) Weryfikuj rÃ³wnanie chemiczne, 3) ZnajdÅº szczegÃ³Å‚y etapÃ³w, 4) Oblicz efektywnoÅ›Ä‡, 5) Zsyntetyzuj kompletnÄ… odpowiedÅº"},
              {"type": "toolcall", "content": "search_knowledge_base(query=\"fotosynteza definicja proces\", sources=[\"BioKB-123\", \"SciencePrimer\"])"},
              {"type": "result", "content": "Znaleziono 3 dokumenty: Fotosynteza to proces konwersji energii Å›wietlnej w chemicznÄ…, zachodzi w chloroplastach. Etapy: reakcje Å›wietlne i cykl Calvina."},
              {"type": "toolcall", "content": "formula_validator(formula=\"6CO2 + 6H2O -> C6H12O6 + 6O2\", check_balance=true)"},
              {"type": "result", "content": "RÃ³wnanie zbilansowane âœ“. Atomy: C:6â†’6, H:12â†’12, O:18â†’18. RÃ³wnanie poprawne chemicznie."},
              {"type": "toolcall", "content": "search_knowledge_base(query=\"reakcje Å›wietlne cykl Calvina szczegÃ³Å‚y\", depth=\"detailed\")"},
              {"type": "result", "content": "Reakcje Å›wietlne (tylakoidy): Chlorofil pochÅ‚ania fotony 680nm i 700nm, fotoliza wody, produkcja ATP i NADPH. Cykl Calvina (stroma): Fiksacja COâ‚‚, synteza glukozy przy uÅ¼yciu ATP i NADPH."},
              {"type": "toolcall", "content": "calculate_efficiency(input_energy=\"solar\", output_energy=\"chemical_glucose\", process=\"photosynthesis\")"},
              {"type": "result", "content": "EfektywnoÅ›Ä‡ fotosyntezy: 3-6% w warunkach optymalnych. ZaleÅ¼y od intensywnoÅ›ci PAR (Photosynthetically Active Radiation), temperatury i dostÄ™pnoÅ›ci COâ‚‚."},
              {"type": "reflection", "content": "ZebraÅ‚em kompletne dane: zweryfikowanÄ… definicjÄ™ z wielu ÅºrÃ³deÅ‚, zbilansowane rÃ³wnanie chemiczne, szczegÃ³Å‚owe opisy obu etapÃ³w biochemicznych i obliczonÄ… efektywnoÅ›Ä‡ energetycznÄ…. W przeciwieÅ„stwie do RAG, ktÃ³ry tylko cytuje dokumenty, wykonaÅ‚em walidacjÄ™ rÃ³wnania i obliczenia efektywnoÅ›ci."},
              {"type": "final", "content": "SyntetyzujÄ™ zwiÄ™zÅ‚Ä… odpowiedÅº zawierajÄ…cÄ…: proces, etapy, rÃ³wnanie chemiczne i efektywnoÅ›Ä‡ - wszystko zweryfikowane i obliczone, nie tylko zacytowane."}
            ]
          }
        },
        {
          "prompt": "PorÃ³wnaj zalety i wady samochodÃ³w elektrycznych i samochodÃ³w benzynowych.",
          "llm": {
            "text": "Pojazdy elektryczne majÄ… zazwyczaj niÅ¼sze koszty eksploatacji i zerowe emisje spalin, ale wyÅ¼sze ceny zakupu i ograniczony zasiÄ™g. Samochody benzynowe sÄ… taÅ„sze w zakupie i tankujÄ… szybciej przy wiÄ™kszej infrastrukturze, ale majÄ… emisje i wyÅ¼sze koszty paliwa.",
            "tokens": 46,
            "latencyMs": 480,
            "costUsd": 0.00046
          },
          "reasoning": {
            "text": "Systematyczne porÃ³wnanie:\n1.  **Koszt:** EV wyÅ¼sze koszty poczÄ…tkowe, niÅ¼sze eksploatacyjne (paliwo/utrzymanie). Samochody benzynowe odwrotnie.\n2.  **Åšrodowisko:** EV zerowe emisje spalin (ale wpÅ‚yw produkcji baterii). Samochody benzynowe majÄ… bezpoÅ›rednie emisje.\n3.  **WydajnoÅ›Ä‡/Wygoda:** EV ciche, szybkie przyspieszenie. Samochody benzynowe wiÄ™kszy zasiÄ™g, szybsze tankowanie.\n4.  **Infrastruktura:** Tankowanie benzyny powszechne. Åadowanie EV roÅ›nie, ale mniej dostÄ™pne.\n**Wniosek:** WybÃ³r zaleÅ¼y od budÅ¼etu, potrzeb transportowych, priorytetÃ³w ekologicznych i lokalnej infrastruktury.",
            "tokens": 85,
            "latencyMs": 700,
            "costUsd": 0.00080,
            "reasoningTrace": [
              "Cel: PorÃ³wnaÄ‡ pojazdy EV i benzynowe",
              "Metoda: Analiza zalet i wad",
              "Zdefiniuj kategorie: Koszt (Zakup, Eksploatacja), Åšrodowisko, WydajnoÅ›Ä‡/Wygoda, Infrastruktura",
              "Analizuj EV: WymieÅ„ zalety/wady w kaÅ¼dej kategorii",
              "Analizuj samochody benzynowe: WymieÅ„ zalety/wady w kaÅ¼dej kategorii",
              "UporzÄ…dkuj wyniki: Prezentuj odkrycia kategoria po kategorii",
              "Synteza: Dodaj podsumowanie uwzglÄ™dniajÄ…ce kompromisy."
            ]
          },
          "rag": {
            "text": "DostÄ™p do wewnÄ™trznych raportÃ³w rynkowych i technicznych:\nEV wykazujÄ… niÅ¼szy TCO w ciÄ…gu 5 lat wedÅ‚ug naszej analizy [Dok: MktAnalys-Q1]. Emisje spalin sÄ… zerowe, ale kluczowa jest ocena cyklu Å¼ycia baterii [Dok: TechAssess-EV7]. Samochody benzynowe zachowujÄ… przewagÄ™ w szybkoÅ›ci tankowania i poczÄ…tkowym koszcie, choÄ‡ zmiennoÅ›Ä‡ cen paliwa jest ryzykiem [Dok: MktAnalys-Q1].",
            "tokens": 68,
            "latencyMs": 820,
            "costUsd": 0.00080,
            "citations": [
              {
                "title": "Dokument wewnÄ™trzny: MktAnalys-Q1",
                "snippet": "Analiza rynku Q1 porÃ³wnujÄ…ca caÅ‚kowity koszt posiadania (TCO) pojazdÃ³w EV i spalinowych...",
                "url": "#"
              },
              {
                "title": "Dokument wewnÄ™trzny: TechAssess-EV7",
                "snippet": "Dokument oceny technologicznej obejmujÄ…cy emisje w cyklu Å¼ycia baterii EV i recykling...",
                "url": "#"
              }
            ]
          },
          "agent": {
            "text": "Na podstawie analizy danych rynkowych dla Polski (2024): **EV sÄ… korzystniejsze finansowo** przy przejechaniu >15k km rocznie â€“ TCO na 5 lat to 165k PLN vs 178k PLN dla benzynowych (oszczÄ™dnoÅ›Ä‡ 13k PLN). EV emitujÄ… o 54% mniej COâ‚‚ i majÄ… 3x wyÅ¼szÄ… efektywnoÅ›Ä‡ energetycznÄ… (85-90% vs 20-30%). JednakÅ¼e benzynowe oferujÄ… wiÄ™kszy zasiÄ™g (600-800km vs 350-500km) i szybsze tankowanie. **Rekomendacja:** EV dla jazdy miejskiej i regularnych tras, benzynowe dla czÄ™stych dÅ‚ugodystansowych podrÃ³Å¼y.",
            "tokens": 186,
            "latencyMs": 2100,
            "costUsd": 0.00195,
            "agentTrace": [
              {"type": "plan", "content": "Kompleksowa analiza: 1) Pobierz aktualne dane rynkowe PL, 2) Oblicz TCO na 5 lat, 3) PorÃ³wnaj emisje COâ‚‚, 4) Analizuj efektywnoÅ›Ä‡ energetycznÄ…, 5) Weryfikuj wszystkie obliczenia, 6) Wygeneruj rekomendacje oparte na danych"},
              {"type": "toolcall", "content": "fetch_market_data(vehicle_type=\"EV\", market=\"Poland\", year=2024, data=[\"avg_price\", \"energy_cost\", \"maintenance\"])"},
              {"type": "result", "content": "EV Polska 2024: Åšrednia cena zakupu: 150k PLN, koszt energii: 0.75 PLN/kWh, Å›rednie zuÅ¼ycie: 15 kWh/100km, koszty serwisu: -40% vs benzynowe (niÅ¼sze zuÅ¼ycie czÄ™Å›ci, brak wymiany oleju)"},
              {"type": "toolcall", "content": "fetch_market_data(vehicle_type=\"ICE\", market=\"Poland\", year=2024, data=[\"avg_price\", \"fuel_cost\", \"maintenance\"])"},
              {"type": "result", "content": "Benzynowe Polska 2024: Åšrednia cena zakupu: 90k PLN, koszt paliwa: 6.50 PLN/l, Å›rednie spalanie: 7l/100km, standardowe koszty serwisu (olej, filtry, rozrzÄ…d)"},
              {"type": "toolcall", "content": "calculate_tco(ev_data={price:150000, energy_kwh_per_100km:15, cost_per_kwh:0.75, maintenance_factor:0.6}, ice_data={price:90000, fuel_l_per_100km:7, cost_per_liter:6.5, maintenance_factor:1.0}, years=5, km_per_year=20000)"},
              {"type": "result", "content": "TCO dla 5 lat (100 000 km): EV = 165 000 PLN (zakup 150k + energia 11.25k + serwis 3.75k), ICE = 178 000 PLN (zakup 90k + paliwo 45.5k + serwis 12.5k). OszczÄ™dnoÅ›Ä‡ EV: 13 000 PLN (7.3%)"},
              {"type": "toolcall", "content": "emission_calculator(ev_kwh_per_km=0.15, ice_l_per_km=0.07, distance_km=100000, grid_mix=\"Poland_2024\", include_production=true)"},
              {"type": "result", "content": "Emisje dla 100k km: EV = 8.4 tony COâ‚‚ (uwzglÄ™dnia mix energetyczny Polski: 70% wÄ™giel + produkcja baterii), ICE = 18.2 tony COâ‚‚ (spalanie benzyny + produkcja). Redukcja emisji: 9.8 tony (54%)"},
              {"type": "toolcall", "content": "efficiency_analyzer(ev_motor_efficiency=0.9, ev_battery_efficiency=0.95, ice_engine_efficiency=0.25, ice_drivetrain_efficiency=0.85)"},
              {"type": "result", "content": "EfektywnoÅ›Ä‡ caÅ‚kowita: EV = 85.5% (motor 90% Ã— bateria 95%), ICE = 21.3% (silnik 25% Ã— napÄ™d 85%). Reszta energii tracona jako ciepÅ‚o. EV ~4x wydajniejsze."},
              {"type": "toolcall", "content": "validate_calculations(tco_delta=-13000, emission_reduction_percent=54, efficiency_ratio=4.0, cross_reference_sources=[\"MktAnalys-Q1\", \"TechAssess-EV7\"])"},
              {"type": "result", "content": "Walidacja âœ“: Wszystkie obliczenia zgodne z danymi ÅºrÃ³dÅ‚owymi. TCO potwierdzone przez MktAnalys-Q1, emisje zgodne z TechAssess-EV7. Wyniki wiarygodne."},
              {"type": "reflection", "content": "PrzeprowadziÅ‚em analizÄ™ uÅ¼ywajÄ…c 6 rÃ³Å¼nych narzÄ™dzi: pobraÅ‚em aktualne dane rynkowe dla Polski, obliczyÅ‚em szczegÃ³Å‚owy TCO uwzglÄ™dniajÄ…c wszystkie koszty, zmierzyÅ‚em emisje COâ‚‚ z lokalnym mixem energetycznym, przeanalizowaÅ‚em efektywnoÅ›Ä‡ i zwalidowaÅ‚em wszystkie wyniki wzglÄ™dem ÅºrÃ³deÅ‚. W przeciwieÅ„stwie do RAG, ktÃ³ry tylko cytuje ogÃ³lne stwierdzenia, dostarczam konkretnych liczb, obliczeÅ„ ROI i rekomendacji opartych na profilu uÅ¼ytkowania."},
              {"type": "final", "content": "SyntetyzujÄ™ odpowiedÅº z kluczowymi wnioskami: TCO, emisjami, efektywnoÅ›ciÄ… i jasnÄ… rekomendacjÄ…. Wszystkie dane zweryfikowane i obliczone, nie tylko zacytowane z dokumentÃ³w."}
            ]
          }
        },
         {
          "prompt": "Jaka jest polityka firmy dotyczÄ…ca pracy zdalnej?",
          "llm": {
            "text": "Polityka pracy zdalnej w firmach zazwyczaj okreÅ›la kryteria kwalifikacji, oczekiwania dotyczÄ…ce komunikacji i wydajnoÅ›ci, wymagania dotyczÄ…ce domowego biura oraz ograniczenia lokalizacji. NaleÅ¼y zazwyczaj zapoznaÄ‡ siÄ™ z oficjalnym podrÄ™cznikiem HR lub dokumentami polityki w celu uzyskania szczegÃ³Å‚Ã³w.",
            "tokens": 43,
            "latencyMs": 450,
            "costUsd": 0.00043
          },
          "reasoning": {
            "text": "Aby okreÅ›liÄ‡ politykÄ™ pracy zdalnej:\n1.  **Zakres:** Polityka dotyczy pracownikÃ³w peÅ‚noetatowych.\n2.  **Kwalifikacje:** Wymaga zgody menedÅ¼era i odpowiednioÅ›ci stanowiska (zdefiniowana lista).\n3.  **Wymagania:** NaleÅ¼y zachowaÄ‡ podstawowe godziny pracy (10:00-16:00 czasu lokalnego), bezpieczny internet, dedykowane miejsce pracy.\n4.  **Lokalizacja:** NaleÅ¼y przebywaÄ‡ w zatwierdzonych krajach/stanach.\n**Podsumowanie:** Uprawnieni pracownicy mogÄ… pracowaÄ‡ zdalnie za zgodÄ… menedÅ¼era, z zastrzeÅ¼eniem okreÅ›lonego stanowiska, konfiguracji i wymagaÅ„ lokalizacyjnych.",
            "tokens": 75,
            "latencyMs": 680,
            "costUsd": 0.00070,
            "reasoningTrace": [
              "Cel: OkreÅ›liÄ‡ politykÄ™ pracy zdalnej firmy",
              "Å¹rÃ³dÅ‚o informacji: ZakÅ‚adaj dostÄ™p do wewnÄ™trznych zasad/logiki HR.",
              "Krok 1: OkreÅ›l, do kogo odnosi siÄ™ polityka (np. typy pracownikÃ³w).",
              "Krok 2: OkreÅ›l kryteria kwalifikacji (np. typ stanowiska, zgoda menedÅ¼era).",
              "Krok 3: Zidentyfikuj wymagania operacyjne (np. godziny, sprzÄ™t, Å‚Ä…cznoÅ›Ä‡).",
              "Krok 4: SprawdÅº ograniczenia (np. ograniczenia geograficzne).",
              "Krok 5: Zsyntetyzuj odkrycia w uporzÄ…dkowane podsumowanie polityki."
            ]
          },
          "rag": {
            "text": "Sprawdzam oficjalne dokumenty HR:\nPolityka pracy zdalnej [Dok: HRManual-Sec4.B] stwierdza, Å¼e kwalifikacja wymaga zgody menedÅ¼era i odpowiednioÅ›ci stanowiska. Pracownicy muszÄ… utrzymywaÄ‡ wyznaczone miejsce pracy i przestrzegaÄ‡ protokoÅ‚Ã³w bezpieczeÅ„stwa okreÅ›lonych w [Dok: RemoteGuide-v3]. PeÅ‚ne szczegÃ³Å‚y znajdujÄ… siÄ™ w PodrÄ™czniku HR.",
            "tokens": 55,
            "latencyMs": 750,
            "costUsd": 0.00075,
            "citations": [
              {
                "title": "Dokument wewnÄ™trzny: HRManual-Sec4.B",
                "snippet": "Sekcja 4.B: Polityka pracy zdalnej, w tym kwalifikacje, proces skÅ‚adania wnioskÃ³w i obowiÄ…zki menedÅ¼era...",
                "url": "#"
              },
              {
                "title": "Dokument wewnÄ™trzny: RemoteGuide-v3",
                "snippet": "Wersja 3 Wytycznych pracy zdalnej, szczegÃ³Å‚owo opisujÄ…ca wymagania dotyczÄ…ce miejsca pracy, protokoÅ‚y bezpieczeÅ„stwa i oczekiwania komunikacyjne...",
                "url": "#"
              }
            ]
          },
          "agent": {
            "text": "Na podstawie aktualnych dokumentÃ³w HR (wrzesieÅ„ 2024): pracownicy peÅ‚noetatowi z min. 6 mies. staÅ¼em mogÄ… pracowaÄ‡ zdalnie po uzyskaniu zgody managera. **KwalifikujÄ… siÄ™ stanowiska:** IT, Marketing, Finanse, HR (88% zespoÅ‚u). **Wymagania:** Internet 50/10 Mbps, VPN Cisco AnyConnect, dostÄ™pnoÅ›Ä‡ 10:00-16:00 CET. **Lokalizacja:** PL, DE, NL, CZ dozwolone; inne kraje UE wymagajÄ… zgody Legal; spoza UE zakazane (RODO). **Proces:** WFH-01 form â†’ akceptacja (3 dni) â†’ IT setup (5 dni) â†’ trial (3 mies.). Obecnie 67% zespoÅ‚u pracuje zdalnie.",
            "tokens": 248,
            "latencyMs": 2350,
            "costUsd": 0.00260,
            "agentTrace": [
              {"type": "plan", "content": "Kompleksowa analiza: 1) Parsuj HRManual-Sec4.B (kwalifikacje, proces), 2) Parsuj RemoteGuide-v3 (wymagania tech), 3) Cross-reference z Compliance (lokalizacje), 4) WyodrÄ™bnij konkretne Â§, 5) SprawdÅº wersje dokumentÃ³w, 6) Pobierz statystyki adopcji, 7) Waliduj spÃ³jnoÅ›Ä‡ miÄ™dzy politykami"},
              {"type": "toolcall", "content": "document_parser(doc_id=\"HRManual-Sec4.B\", extract_sections=[\"eligibility\", \"application_process\", \"requirements\"], version=\"latest\", output_format=\"structured\")"},
              {"type": "result", "content": "HRManual-Sec4.B v2.3 (data publikacji: 2024-09-15): Â§2.1 Kwalifikacje - pracownicy peÅ‚noetatowi, min. 6 miesiÄ™cy staÅ¼u, zgoda bezpoÅ›redniego managera, pozytywna ocena roczna (min. 'speÅ‚nia oczekiwania'). Lista stanowisk kwalifikowanych: IT (100%), Marketing (95%), Finanse (80%), HR (90%) - Å‚Ä…cznie 88% zespoÅ‚u."},
              {"type": "toolcall", "content": "document_parser(doc_id=\"RemoteGuide-v3\", extract_sections=[\"technical_requirements\", \"working_hours\", \"equipment_provision\"], version=\"latest\")"},
              {"type": "result", "content": "RemoteGuide-v3 (aktualizacja: 2024-08): Â§3 Wymagania techniczne - Internet: minimum 50 Mbps download / 10 Mbps upload (weryfikowane przez IT), VPN: obowiÄ…zkowe Cisco AnyConnect, SprzÄ™t: laptop + monitor firmowy (dostarcza dziaÅ‚ IT), Backup: zalecany hotspot mobilny. Core hours: 10:00-16:00 CET (obowiÄ…zkowa dostÄ™pnoÅ›Ä‡), flextime: pozostaÅ‚e 2h w oknie 7:00-20:00."},
              {"type": "toolcall", "content": "cross_reference_check(source_docs=[\"HRManual-Sec4.B\", \"RemoteGuide-v3\", \"CompliancePolicy-v2.1\"], field=\"geographical_restrictions\", validate_consistency=true)"},
              {"type": "result", "content": "Compliance Policy Â§4.2 'Lokalizacja pracy zdalnej': Dozwolone bez dodatkowej zgody: Polska, Niemcy, Holandia, Czechy (weryfikacja podatkowa + umowa z lokalnym payroll). PozostaÅ‚e kraje UE: wymagana zgoda dziaÅ‚u Legal i Compliance (case-by-case). Spoza UE: zabronione ze wzglÄ™du na RODO i wymogi compliance. Cross-reference âœ“ - wszystkie 3 dokumenty spÃ³jne."},
              {"type": "toolcall", "content": "extract_process_flow(document=\"HRManual-Sec4.B\", section=\"remote_work_application\", include_timelines=true, include_stakeholders=true)"},
              {"type": "result", "content": "Proces aplikacji o pracÄ™ zdalnÄ…: Krok 1 - WypeÅ‚nienie formularza WFH-01 (Work From Home Application), Krok 2 - Manager review i decyzja (SLA: 3 dni robocze), Krok 3 - Po akceptacji: automatyczne zgÅ‚oszenie do IT setup (SLA: 5 dni na dostawÄ™ sprzÄ™tu + konfiguracja VPN), Krok 4 - ObowiÄ…zkowe szkolenie bezpieczeÅ„stwa online (2h, platforma LMS), Krok 5 - Trial period: 3 miesiÄ…ce z review po 6 tygodniach."},
              {"type": "toolcall", "content": "get_statistics(metric=\"remote_work_adoption_rate\", breakdown=[\"by_department\", \"by_work_model\"], timeframe=\"Q4_2024\", include_trends=true)"},
              {"type": "result", "content": "Statystyki adopcji pracy zdalnej Q4 2024: OgÃ³Å‚em: 67% pracownikÃ³w (full remote: 23%, hybrid: 44%, office: 33%). Wzrost r/r: +12%. Breakdown: IT 95% remote/hybrid, Marketing 78%, Finanse 61%, HR 85%, Operations 31%. Trend: stabilizacja po wzroÅ›cie w 2023."},
              {"type": "toolcall", "content": "policy_validator(policies=[\"HRManual-Sec4.B\", \"RemoteGuide-v3\", \"CompliancePolicy-v2.1\"], checks=[\"version_currency\", \"cross_conflicts\", \"legal_compliance\"])"},
              {"type": "result", "content": "Walidacja polityk: âœ“ Wersje aktualne (HRManual: 09/2024, RemoteGuide: 08/2024, Compliance: 07/2024), âœ“ Brak konfliktÃ³w miÄ™dzy dokumentami, âœ“ ZgodnoÅ›Ä‡ z RODO i polskim prawem pracy, âœ“ Wszystkie polityki zatwierdzone przez Legal. Kolejna rewizja zaplanowana: Q1 2025."},
              {"type": "reflection", "content": "WykonaÅ‚em dogÅ‚Ä™bnÄ… analizÄ™ uÅ¼ywajÄ…c 6 specjalistycznych narzÄ™dzi: parsowaÅ‚em 3 dokumenty HR wydobywajÄ…c konkretne paragrafy i wersje, sprawdziÅ‚em cross-reference dla zapewnienia spÃ³jnoÅ›ci lokalizacji miÄ™dzy politykami, wyekstrahowaÅ‚em szczegÃ³Å‚owy proces z timeline'ami i SLA, pobraÅ‚em aktualne statystyki adopcji z breakdown'em, oraz zwalidowaÅ‚em wszystkie polityki pod kÄ…tem aktualnoÅ›ci i zgodnoÅ›ci prawnej. W przeciwieÅ„stwie do RAG ktÃ³ry tylko cytuje fragmenty dokumentÃ³w, dostarczam zweryfikowane, strukturalne informacje z konkretnymi referencjami do paragrafÃ³w, timeline'ami procesu i kontekstem iloÅ›ciowym."},
              {"type": "final", "content": "SyntetyzujÄ™ kompletnÄ… odpowiedÅº obejmujÄ…cÄ…: kwalifikacje z konkretnym Â§, szczegÃ³Å‚owe wymagania techniczne, restrykcje lokalizacyjne z podstawÄ… prawnÄ…, peÅ‚ny proces aplikacji z SLA, i statystyki adopcji - wszystko zweryfikowane i ze ÅºrÃ³dÅ‚ami, nie tylko zacytowane."}
            ]
          }
        }
      ],
      "defaultAnswer": {
        "text": "Nie mam konkretnych symulowanych danych dla tego zapytania. ProszÄ™ wybraÄ‡ jedno z przykÅ‚adowych zapytaÅ„, aby zobaczyÄ‡ porÃ³wnanie.",
        "tokens": 21,
        "latencyMs": 300,
        "costUsd": 0.00015
      }
    }
    </script>

    <script>
        // --- DOM Element References ---
        // Get references to necessary HTML elements
        const qData = JSON.parse(document.getElementById('questionData').textContent); // Parse the corrected JSON
        const promptInput = document.getElementById('promptInput');
        const sendBtn = document.getElementById('sendBtn');
        const chatContainer = document.getElementById('chatContainer');
        const alertBox = document.getElementById('alert');
        const promptSelect = document.getElementById('promptSelect');

        // --- Paradigm Definitions with Icons and Descriptions ---
        // Define the different chatbot types to simulate
        const paradigms = [
            {
                key: 'llm',
                label: 'Chat LLM',
                color: 'bg-white', // Background color class
                iconSvg: `<svg class="inline-icon w-5 h-5 text-purple-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 0 0 2.25-2.25V8.25a2.25 2.25 0 0 0-2.25-2.25H6.75A2.25 2.25 0 0 0 4.5 8.25v10.5A2.25 2.25 0 0 0 6.75 21H9" /></svg>`,
                description: 'Generuje tekst bezpoÅ›rednio z obszernych danych treningowych.'
            },
            {
                key: 'reasoning',
                label: 'Chat z rozumowaniem',
                color: 'bg-green-50',
                iconSvg: `<svg class="inline-icon w-5 h-5 text-green-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.43.992a6.759 6.759 0 0 1 0 1.903c.008.378.137.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.6 6.6 0 0 1-.22.128c-.332.183-.582.495-.644.869l-.213 1.28c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.759 6.759 0 0 1 0-1.903c-.007-.378-.137-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582.495.644-.869l.214-1.28Z" /></svg>`,
                description: 'Wykorzystuje wewnÄ™trzne kroki logiczne lub planowanie przed odpowiedziÄ….'
            },
            {
                key: 'rag',
                label: 'Chat RAG',
                color: 'bg-blue-50',
                iconSvg: `<svg class="inline-icon w-5 h-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607ZM10.5 7.5v6m3-3h-6" /></svg>`,
                description: 'Najpierw wyszukuje informacje ze zdefiniowanej bazy wiedzy.'
            },
            {
                key: 'agent',
                label: 'Chat Agent',
                color: 'bg-orange-50',
                iconSvg: `<svg class="inline-icon w-5 h-5 text-orange-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17 17.25 21A2.652 2.652 0 0 0 21 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 1 1-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 0 0 4.486-6.336l-3.276 3.277a3.004 3.004 0 0 1-2.25-2.25l3.276-3.276a4.5 4.5 0 0 0-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437 1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008Z" /></svg>`,
                description: 'Wykorzystuje narzÄ™dzia i przechodzi przez etapy: plan, akcja, refleksja.'
            }
        ];

        // --- Function to Populate Sample Prompts Dropdown ---
        function populatePrompts() {
            // Clear existing options before adding new ones
            promptSelect.innerHTML = '';
            // Create and add a placeholder option
            const placeholderOption = document.createElement('option');
            placeholderOption.textContent = '-- Wybierz przykÅ‚adowe zapytanie --';
            placeholderOption.value = ""; // Empty value for placeholder
            placeholderOption.disabled = true;
            placeholderOption.selected = true;
            promptSelect.appendChild(placeholderOption);

            // Add an option for each question in the data
            qData.questions.forEach(q => {
                const option = document.createElement('option');
                option.value = q.prompt; // Set the value to the prompt text
                option.textContent = q.prompt; // Set the display text
                promptSelect.appendChild(option);
            });
            console.log("Prompts populated."); // Debug log
        }


        // --- Function to Create an Individual Chat Pane ---
        function createPane(paradigm) {
            const paneDiv = document.createElement('div');
            // Apply styling for the chat pane using Tailwind classes
            paneDiv.className = `${paradigm.color} p-4 rounded-lg shadow-md flex flex-col border border-gray-200 min-h-[300px]`;
            // Set inner HTML structure for the pane (header, output area, metrics area)
            paneDiv.innerHTML = `
                <div class="flex-shrink-0"> <h2 class="font-semibold mb-1 text-lg text-gray-800">${paradigm.iconSvg}${paradigm.label}</h2>
                    <p class="text-xs text-gray-600 mb-3">${paradigm.description}</p>
                </div>
                <div class="flex-grow overflow-y-auto text-gray-700 leading-relaxed mb-2" data-output></div> <div class="flex-shrink-0 text-xs text-gray-500 mt-auto border-t border-gray-200 pt-2" data-metrics></div> `;
            return paneDiv;
        }

        // --- Function to Render Typing Output ---
        function renderOutput(outputContainer, answerData, mode) {
            outputContainer.textContent = ''; // Clear previous content
            // Split text carefully by newline, bold markdown, or LaTeX, preserving delimiters
            const segments = answerData.text.split(/(\n|\*\*.*?\*\*|\$.*?\$)/).filter(Boolean);
            let segmentIndex = 0;
            const span = document.createElement('span'); // Use a span for the typing effect
            outputContainer.appendChild(span);
            span.classList.add('typing'); // Add typing cursor class

            // Calculate delay per segment for the typing animation
            const totalDuration = answerData.latencyMs * 0.7; // Use 70% of latency for typing effect
            const delayPerSegment = Math.max(30, totalDuration / Math.max(segments.length, 1)); // Minimum 30ms delay

            // Interval timer to append segments one by one
            const intervalId = setInterval(() => {
                if (segmentIndex < segments.length) {
                    let currentSegment = segments[segmentIndex];
                    // Handle different segment types (newline, bold, LaTeX, plain text)
                    if (currentSegment === '\n') {
                        span.innerHTML += '<br>';
                    } else if (currentSegment.startsWith('**') && currentSegment.endsWith('**')) {
                        span.innerHTML += `<strong>${currentSegment.slice(2, -2)}</strong>`; // Render bold
                    } else if (currentSegment.startsWith('$') && currentSegment.endsWith('$')) {
                        span.innerHTML += currentSegment; // Keep LaTeX as is for MathJax
                    } else {
                        span.textContent += currentSegment; // Append regular text
                    }
                    segmentIndex++;
                } else {
                    // Typing finished
                    span.classList.remove('typing'); // Remove typing cursor
                    clearInterval(intervalId); // Stop the interval

                    // Add reasoning or citations sections *after* typing finishes
                    // These are added to the parent container of the output div
                    if (mode === 'reasoning' && answerData.reasoningTrace) {
                        addReasoning(outputContainer.parentNode, answerData.reasoningTrace);
                    }
                    if (mode === 'rag' && answerData.citations) {
                        addCitations(outputContainer.parentNode, answerData.citations);
                    }
                    if (mode === 'agent' && answerData.agentTrace) {
                        addAgentTrace(outputContainer.parentNode, answerData.agentTrace);
                    }

                    // Trigger MathJax typesetting if available
                    if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
                        MathJax.typesetPromise([outputContainer]).catch(function (err) {
                           console.error('MathJax typesetting error:', err); // Log errors
                        });
                    }
                }
            }, delayPerSegment);
        }


        // --- Function to Add Reasoning Steps Section ---
        function addReasoning(container, trace) {
            // Remove existing reasoning section first to prevent duplicates
            const existingDetails = container.querySelector('.reasoning-details');
            if (existingDetails) existingDetails.remove();

            // Create details/summary element for accordion effect
            const details = document.createElement('details');
            details.className = 'reasoning-details mt-3 text-sm border-t border-green-200 pt-2 bg-green-50 p-3 rounded'; // Styling
            // Summary text with an icon
            details.innerHTML = '<summary class="font-medium text-green-800 cursor-pointer text-base mb-1 flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z" /></svg>Kroki rozumowania</summary>';
            // Create ordered list for the steps
            const list = document.createElement('ol');
            list.className = 'list-decimal list-inside text-green-900 mt-1 space-y-1 pl-2';
            trace.forEach(step => {
                const item = document.createElement('li');
                item.innerHTML = step.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); // Support bold markdown in steps
                list.appendChild(item);
            });
            details.appendChild(list);
            // Insert the reasoning section before the metrics div
            container.insertBefore(details, container.querySelector('[data-metrics]'));
        }

        // --- Function to Add Citations Section ---
        function addCitations(container, citations) {
             // Remove existing citation section first
            const existingCitations = container.querySelector('.citation-section');
            if (existingCitations) existingCitations.remove();

            // Create div for the citation section
            const citationDiv = document.createElement('div');
            citationDiv.className = 'citation-section mt-3 space-y-2 text-xs border-t border-blue-200 pt-2 bg-blue-50 p-3 rounded'; // Styling
            // Title with an icon
            const title = document.createElement('h4');
            title.className = 'font-medium text-blue-800 mb-2 text-sm flex items-center gap-1';
            title.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" /></svg>Bibliografia';
            citationDiv.appendChild(title);

            // Add each citation as a paragraph
            citations.forEach(cit => {
                const p = document.createElement('p');
                p.className = 'text-blue-900';
                // Format citation with title, snippet, and link
                p.innerHTML = `<span class="font-semibold">${cit.title}:</span> "${cit.snippet}" <a href="${cit.url || '#'}" target="_blank" rel="noopener noreferrer" class="text-blue-600 underline hover:text-blue-800">[Link]</a>`;
                citationDiv.appendChild(p);
            });
             // Insert the citation section before the metrics div
            container.insertBefore(citationDiv, container.querySelector('[data-metrics]'));
        }

        // --- Function to Add Agent Trace Section ---
        function addAgentTrace(container, trace) {
            // Remove existing agent trace section first
            const existingTrace = container.querySelector('.agent-trace-section');
            if (existingTrace) existingTrace.remove();

            // Create details/summary element for accordion effect
            const details = document.createElement('details');
            details.className = 'agent-trace-section mt-3 text-sm border-t border-orange-200 pt-2 bg-orange-50 p-3 rounded';
            // Summary text with an icon
            details.innerHTML = '<summary class="font-medium text-orange-800 cursor-pointer text-base mb-1 flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.43.992a6.759 6.759 0 0 1 0 1.903c.008.378.137.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.6 6.6 0 0 1-.22.128c-.332.183-.582.495-.644.869l-.213 1.28c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.759 6.759 0 0 1 0-1.903c-.007-.378-.137-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582.495.644-.869l.214-1.28Z" /></svg>Åšlad wykonania agenta</summary>';

            // Create list for the steps
            const list = document.createElement('div');
            list.className = 'space-y-2 mt-2';

            // Define icons and labels for each step type
            const typeConfig = {
                'plan': { icon: 'ðŸ“‹', label: 'Plan', color: 'text-orange-900 bg-orange-100', border: 'border-orange-300' },
                'toolcall': { icon: 'ðŸ”§', label: 'WywoÅ‚anie narzÄ™dzia', color: 'text-blue-900 bg-blue-100', border: 'border-blue-300' },
                'result': { icon: 'âœ“', label: 'Wynik', color: 'text-green-900 bg-green-100', border: 'border-green-300' },
                'reflection': { icon: 'ðŸ’­', label: 'Refleksja', color: 'text-purple-900 bg-purple-100', border: 'border-purple-300' },
                'final': { icon: 'ðŸŽ¯', label: 'Finalizacja', color: 'text-red-900 bg-red-100', border: 'border-red-300' }
            };

            trace.forEach(step => {
                const config = typeConfig[step.type] || { icon: 'â€¢', label: step.type, color: 'text-gray-900 bg-gray-100', border: 'border-gray-300' };
                const stepDiv = document.createElement('div');
                stepDiv.className = `p-2 rounded border ${config.border} ${config.color}`;
                stepDiv.innerHTML = `<div class="font-semibold text-xs mb-1">${config.icon} ${config.label}</div><div class="text-xs">${step.content}</div>`;
                list.appendChild(stepDiv);
            });

            details.appendChild(list);
            // Insert the agent trace section before the metrics div
            container.insertBefore(details, container.querySelector('[data-metrics]'));
        }


        // --- Function to Render Metrics ---
        function renderMetrics(metricsContainer, answerData) {
            // Display tokens, latency, and estimated cost
            metricsContainer.textContent = `Tokeny: ${answerData.tokens} | OpÃ³Åºnienie: ${answerData.latencyMs} ms | Szac. koszt: $${answerData.costUsd.toFixed(5)}`;
        }

        // --- Main Function to Handle Sending Prompt ---
        function send() {
            console.log("Send function triggered."); // Debug log
            const promptText = promptInput.value.trim();
            // Check if prompt is empty
            if (!promptText) {
                alertBox.textContent = 'ProszÄ™ wprowadziÄ‡ zapytanie lub wybraÄ‡ przykÅ‚ad.';
                alertBox.classList.remove('hidden'); // Show alert
                // Ensure alert is red for error
                alertBox.classList.remove('bg-yellow-100', 'text-yellow-800', 'border-yellow-300');
                alertBox.classList.add('bg-red-100', 'text-red-700', 'border-red-300');
                return;
            }

            // Find matching question data (case-insensitive comparison)
            const exactMatch = qData.questions.find(q => q.prompt.toLowerCase() === promptText.toLowerCase());
            const usingDefault = !exactMatch; // Flag if using default answer
            // Use matched data or the default answer structure
            const dataToShow = exactMatch || {
                llm: qData.defaultAnswer,
                reasoning: qData.defaultAnswer,
                rag: qData.defaultAnswer
            };

            // Clear previous results and hide any existing alert
            chatContainer.innerHTML = '';
            alertBox.classList.add('hidden');

            // Show informational alert if using the default answer set
            if (usingDefault) {
                alertBox.textContent = 'Zapytanie nie znalezione w przykÅ‚adach - pokazujÄ™ domyÅ›lnÄ… symulacjÄ™ odpowiedzi.';
                alertBox.classList.remove('hidden');
                // Style alert as informational (yellow)
                alertBox.classList.remove('bg-red-100', 'text-red-700', 'border-red-300');
                alertBox.classList.add('bg-yellow-100', 'text-yellow-800', 'border-yellow-300');
            }

            // Create and populate panes for each defined paradigm
            paradigms.forEach(paradigm => {
                const pane = createPane(paradigm); // Create the pane structure
                chatContainer.appendChild(pane); // Add pane to the grid

                // Get references to the output and metrics divs within the new pane
                const outputDiv = pane.querySelector('[data-output]');
                const metricsDiv = pane.querySelector('[data-metrics]');
                // Get the specific answer data for this paradigm
                const answer = dataToShow[paradigm.key];

                // Use setTimeout to allow the UI to update before starting animation/metrics rendering
                // This prevents the UI from freezing briefly on potentially slow operations
                setTimeout(() => {
                    renderOutput(outputDiv, answer, paradigm.key); // Start typing animation
                    renderMetrics(metricsDiv, answer); // Display metrics
                }, 50); // Small delay (50ms)
            });

            // Reset dropdown selection if a custom prompt was entered that wasn't a sample
            if (promptSelect.value.toLowerCase() !== promptText.toLowerCase()) {
                 if(promptSelect.options.length > 0) { // Check if options exist
                    promptSelect.selectedIndex = 0; // Reset to the placeholder option
                 }
            }
        }

        // --- Event Listeners for User Interaction ---

        // Send button click
        sendBtn.addEventListener('click', send);

        // Enter key press in the input field
        promptInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault(); // Prevent default form submission if applicable
                send();
            }
        });

        // Sample Prompt Selection Change
         promptSelect.addEventListener('change', () => {
            console.log("Dropdown changed. Selected value:", promptSelect.value); // Debug log
            if (promptSelect.value) { // Only proceed if a valid (non-placeholder) option is selected
                promptInput.value = promptSelect.value; // Update the text input
                promptInput.focus(); // Focus the text input
                send(); // Automatically send the selected prompt
            }
        });


        // --- Initialization ---
        // Populate the prompts dropdown immediately when the script runs
        populatePrompts();

    </script>
</body>
</html>
