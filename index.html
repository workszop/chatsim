<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Symulator Paradygmatów Chatbotów</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configure MathJax
        window.MathJax = {
          tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']] // Define inline math delimiters
          },
          svg: {
            fontCache: 'global'
          }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
    <style>
        /* Custom CSS for typing animation */
        .typing {
            border-right: 2px solid;
            animation: blink .7s steps(1) infinite;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        @keyframes blink {
            50% { border-color: transparent; }
        }
        /* Style for the details summary (accordion trigger) */
        summary { cursor: pointer; }
        /* Ensure icons align nicely with text */
        svg.inline-icon {
            display: inline-block;
            vertical-align: middle;
            margin-right: 0.5rem;
        }
        /* Ensure body takes full height for footer positioning */
        html, body {
            height: 100%;
        }
        body {
            display: flex;
            flex-direction: column;
        }
        main {
            flex-grow: 1; /* Allow main content to fill space */
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 font-sans min-h-screen">

    <header class="bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-700 text-white shadow-2xl sticky top-0 z-10 backdrop-blur-sm">
        <div class="container mx-auto px-4 py-6 text-center">
            <h1 class="text-4xl font-bold tracking-tight">Symulator Paradygmatów Chatbotów</h1>
            <p class="text-blue-100 mt-2 text-base font-medium">
                Odkryj, jak różne podejścia AI radzą sobie z tym samym zapytaniem
            </p>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-6 lg:p-8 flex flex-col items-center">

        <p class="text-center text-gray-700 mb-8 max-w-4xl text-lg leading-relaxed">
            Zobacz, jak <strong class="text-blue-600">cztery różne podejścia AI</strong> odpowiadają na to samo pytanie: od prostego LLM, przez modele z rozumowaniem i dostępem do bazy wiedzy (RAG), aż po <strong class="text-orange-600">zaawansowanego agenta</strong> wykorzystującego narzędzia i wieloetapową analizę.
        </p>

        <div class="w-full max-w-4xl flex flex-col gap-3 mb-8 bg-white p-6 rounded-2xl shadow-xl border border-indigo-100 hover:shadow-2xl transition-shadow duration-300">
            <label for="promptSelect" class="text-sm font-semibold text-gray-800">Wybierz przykładowe zapytanie:</label>
            <select id="promptSelect" class="p-3 rounded-xl border-2 border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-gray-50 hover:bg-white cursor-pointer"></select>
            <div class="flex flex-col sm:flex-row gap-3 mt-2">
                <input id="promptInput" class="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-gray-50 hover:bg-white" placeholder="Lub wpisz własne pytanie...">
                <button id="sendBtn" class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-8 py-3 rounded-xl font-semibold hover:from-blue-700 hover:to-indigo-700 active:scale-95 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
                    </svg>
                    Wyślij
                </button>
            </div>
        </div>

        <div id="alert" class="hidden text-red-800 mb-6 font-semibold p-4 bg-red-50 border-2 border-red-200 rounded-xl w-full max-w-4xl text-sm shadow-md"></div>

        <div id="chatContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5 w-full max-w-7xl">
            </div>

    </main>

    <footer class="bg-gradient-to-r from-slate-900 via-gray-900 to-slate-900 text-gray-400 text-center p-6 mt-12 shadow-2xl border-t border-gray-700">
        <div class="container mx-auto text-sm">
            <p class="font-medium">&copy; 2024 Symulator Chatbotów. Wszelkie prawa zastrzeżone.</p>
        </div>
    </footer>

    <script id="questionData" type="application/json">
    {
      "questions": [
        {
          "prompt": "Wyjaśnij proces fotosyntezy",
          "llm": {
            "text": "Fotosynteza to proces, w którym rośliny wykorzystują światło słoneczne do produkcji pokarmu. Rośliny pobierają dwutlenek węgla z powietrza i wodę z gleby, a następnie przekształcają je w cukry, które są źródłem energii. W tym procesie wydziela się tlen jako produkt uboczny.",
            "tokens": 35,
            "latencyMs": 380,
            "costUsd": 0.00035
          },
          "reasoning": {
            "text": "Analizując fotosyntezę systematycznie:\n**Wejścia procesu:** światło słoneczne, H₂O, CO₂\n**Lokalizacja:** chloroplasty w komórkach roślinnych\n**Etap 1 - Reakcje świetlne (tylakoidy):**\n- Chlorofil pochłania fotony światła\n- Fotoliza wody uwalnia elektrony i O₂\n- Tworzą się nośniki energii: ATP i NADPH\n**Etap 2 - Cykl Calvina (stroma):**\n- ATP i NADPH dostarczają energii\n- CO₂ jest fiksowany i redukowany\n- Powstaje glukoza (C₆H₁₂O₆)\n**Wynik:** energia świetlna → energia chemiczna w cukrach",
            "tokens": 72,
            "latencyMs": 650,
            "costUsd": 0.00072,
            "reasoningTrace": [
              "Cel: Wyjaśnić fotosyntezę krok po kroku",
              "Krok 1: Zidentyfikować substancje wejściowe (światło, H₂O, CO₂) i wyjściowe (glukoza, O₂)",
              "Krok 2: Określić lokalizację procesu (chloroplasty: tylakoidy i stroma)",
              "Krok 3: Rozłożyć proces na dwa główne etapy według lokalizacji",
              "Krok 4: Etap świetlny - światło rozszczepią wodę, powstają ATP i NADPH jako nośniki energii",
              "Krok 5: Cykl Calvina - ATP i NADPH wykorzystywane do przekształcenia CO₂ w glukozę",
              "Krok 6: Zsyntetyzować logiczny przepływ: światło → nośniki energii → synteza cukrów"
            ]
          },
          "rag": {
            "text": "Wyszukuję informacje w bazie wiedzy...\n\n**Znaleziono 3 dokumenty:**\n\nWedług [BioKB-123], fotosynteza zachodzi w **chloroplastach** - organellach zawierających chlorofil. Proces składa się z reakcji świetlnych w tylakoidach i cyklu Calvina w stromie.\n\n[SciencePrimer-Chap4] podaje równanie: $6CO_2 + 6H_2O \\xrightarrow{Światło} C_6H_{12}O_6 + 6O_2$\n\n[PlantPhysiology-v2] wskazuje, że efektywność konwersji energii świetlnej wynosi 3-6% w warunkach optymalnych.",
            "tokens": 58,
            "latencyMs": 820,
            "costUsd": 0.00075,
            "citations": [
              {
                "title": "Dokument wewnętrzny: BioKB-123 (Biologia Komórkowa)",
                "snippet": "...chloroplasty to organelle zawierające chlorofil, w których zachodzi fotosynteza. Składają się z tylakoidów (reakcje świetlne) i stromy (cykl Calvina)...",
                "url": "#"
              },
               {
                "title": "Dokument wewnętrzny: SciencePrimer-Chap4",
                "snippet": "...równanie fotosyntezy: 6CO₂ + 6H₂O + energia świetlna → C₆H₁₂O₆ + 6O₂. Proces ten jest podstawą życia na Ziemi...",
                "url": "#"
              },
              {
                "title": "Dokument wewnętrzny: PlantPhysiology-v2",
                "snippet": "...efektywność fotosyntetyczna wynosi średnio 3-6% w optymalnych warunkach (PAR, temperatura, CO₂). Reszta energii jest tracona jako ciepło...",
                "url": "#"
              }
            ]
          },
          "agent": {
            "text": "Po kompleksowej analizie z użyciem narzędzi:\n\nFotosynteza to proces w chloroplastach, składający się z dwóch etapów:\n**1) Reakcje świetlne** (tylakoidy): absorpcja fotonów 680-700nm przez chlorofil a i b → fotoliza H₂O → produkcja ATP i NADPH → uwolnienie O₂\n**2) Cykl Calvina** (stroma): fiksacja CO₂ przez RuBisCO → redukcja z wykorzystaniem ATP/NADPH → synteza C₆H₁₂O₆\n\n**Równanie zwalidowane chemicznie:** $6CO_2 + 6H_2O \\xrightarrow{Światło} C_6H_{12}O_6 + 6O_2$ ✓\n\n**Wydajność:** 3-6% (obliczona dla PAR 400-700nm, temp. 25°C, CO₂ 400ppm)",
            "tokens": 158,
            "latencyMs": 1950,
            "costUsd": 0.00165,
            "agentTrace": [
              {"type": "plan", "content": "Strategia: 1) Przeszukaj bazę wiedzy dla podstaw, 2) Waliduj równanie chemiczne (bilans atomów), 3) Pobierz szczegóły mechanizmów obu etapów, 4) Oblicz efektywność dla standardowych warunków, 5) Zsyntetyzuj zweryfikowaną odpowiedź"},
              {"type": "toolcall", "content": "search_knowledge_base(query=\"fotosynteza chloroplasty mechanizm\", sources=[\"BioKB-123\", \"SciencePrimer\", \"PlantPhysiology\"], depth=\"comprehensive\")"},
              {"type": "result", "content": "Znaleziono 5 dokumentów: Fotosynteza w chloroplastach. Dwa główne etapy: reakcje świetlne w tylakoidach (fotosystemy I i II) i cykl Calvina w stromie (fiksacja CO₂ przez enzym RuBisCO)."},
              {"type": "toolcall", "content": "chemistry_validator(equation=\"6CO2 + 6H2O -> C6H12O6 + 6O2\", check_balance=true, check_charge=true)"},
              {"type": "result", "content": "✓ Równanie zbilansowane. Atomy: C(6→6), H(12→12), O(18→18). Bilans ładunku: neutralny. Delta G°: +2870 kJ/mol (endergoniczny - wymaga energii świetlnej)."},
              {"type": "toolcall", "content": "search_knowledge_base(query=\"reakcje świetlne fotosystemy wavelength ATP NADPH\", depth=\"detailed\")"},
              {"type": "result", "content": "Reakcje świetlne: Fotosystem II (P680, λ=680nm) - fotoliza wody, Fotosystem I (P700, λ=700nm) - redukcja NADP+. Chlorofil a/b absorpcja: 430-450nm i 640-700nm. Produkty: ATP (fotofosforylacja), NADPH, O₂."},
              {"type": "toolcall", "content": "search_knowledge_base(query=\"cykl Calvina RuBisCO fiksacja CO2 etapy\", depth=\"detailed\")"},
              {"type": "result", "content": "Cykl Calvina (3 fazy): 1) Fiksacja - RuBisCO wiąże CO₂ z RuBP, 2) Redukcja - wykorzystanie ATP i NADPH, 3) Regeneracja RuBP. Na 6 cykli: 6CO₂ → 1 glukoza (C₆H₁₂O₆)."},
              {"type": "toolcall", "content": "efficiency_calculator(input_photon_energy=\"PAR_400_700nm\", output_glucose_energy=\"C6H12O6\", temperature=25, co2_ppm=400, calculate_theoretical_max=true)"},
              {"type": "result", "content": "Efektywność fotosyntetyczna: Teoretyczna max: 11%, Rzeczywista: 3-6% (C3 plants w warunkach optymalnych: PAR 400-700nm, 25°C, 400ppm CO₂). Straty: odbicie (8%), transmisja (10%), ciepło (76-80%)."},
              {"type": "toolcall", "content": "cross_validate(sources=[\"BioKB-123\", \"SciencePrimer-Chap4\", \"PlantPhysiology-v2\"], fields=[\"equation\", \"efficiency\", \"mechanism\"])"},
              {"type": "result", "content": "✓ Cross-validation sukces. Równanie: 3/3 źródła zgodne, Efektywność: 3-6% potwierdzona w 2/3 źródłach, Mechanizm: opis spójny we wszystkich źródłach."},
              {"type": "reflection", "content": "Wykonałem kompleksową analizę używając 6 narzędzi: przeszukałem bazę wiedzy (5 dokumentów), zwalidowałem chemicznie równanie z bilansem atomów i energii (ΔG°), wyekstrahowałem szczegóły mechanizmów obu etapów ze spektrum absorpcji chlorofilu, obliczyłem rzeczywistą efektywność dla określonych warunków, oraz skrzyżowałem dane z 3 źródeł dla weryfikacji. W przeciwieństwie do RAG który tylko cytuje, dostarczam zweryfikowanych danych z obliczeniami i walidacją chemiczną."},
              {"type": "final", "content": "Syntetyzuję odpowiedź: szczegółowy mechanizm obu etapów z długościami fal i enzymami, równanie chemicznie zwalidowane z ΔG°, efektywność obliczona dla konkretnych warunków - wszystko cross-validated z wieloma źródłami."}
            ]
          }
        },
        {
          "prompt": "Porównaj zalety i wady samochodów elektrycznych i samochodów benzynowych.",
          "llm": {
            "text": "Samochody elektryczne są bardziej ekologiczne, ponieważ nie emitują spalin i są cichsze. Koszty eksploatacji są niższe dzięki tańszej energii elektrycznej i mniejszej ilości serwisów. Jednak są droższe w zakupie i mają ograniczony zasięg.\n\nSamochody benzynowe są tańsze, mają większy zasięg i szybsze tankowanie. Infrastruktura stacji benzynowych jest bardziej rozbudowana. Z drugiej strony paliwo jest droższe i pojazdy generują emisje CO₂.",
            "tokens": 52,
            "latencyMs": 450,
            "costUsd": 0.00052
          },
          "reasoning": {
            "text": "Analizując porównanie metodycznie w 4 wymiarach:\n\n**1. Ekonomia:**\n- EV: wysoka cena zakupu vs niskie koszty energii (~4x tańsze niż benzyna) i serwisu (brak oleju, filtrów, układu wydechowego)\n- Benzynowe: niska cena zakupu vs wysokie koszty paliwa i częstsze serwisy\n- Punkt równowagi: przy większym przebiegu (~15k+ km/rok) EV stają się opłacalne\n\n**2. Aspekt środowiskowy:**\n- EV: zerowe lokalne emisje, ale ślad węglowy zależy od źródła energii (węgiel vs OZE)\n- Benzynowe: bezpośrednie emisje CO₂ i NOx przy spalaniu\n- Baterie EV: wpływ produkcji i utylizacji do rozważenia\n\n**3. Użytkowanie:**\n- EV: zasięg 300-500km, ładowanie 30min-8h, niski hałas, natychmiastowy moment obrotowy\n- Benzynowe: zasięg 600-900km, tankowanie 5min, większa dostępność stacji\n\n**4. Infrastruktura:**\n- Sieć stacji benzynowych: dojrzała i gęsta\n- Ładowarki EV: rosnąca, ale wciąż ograniczona dostępność ładowarek szybkich\n\n**Konkluzja:** Wybór powinien bazować na profilu użytkowania (dystans, częstotliwość), dostępie do ładowania i budżecie długoterminowym.",
            "tokens": 145,
            "latencyMs": 820,
            "costUsd": 0.00145,
            "reasoningTrace": [
              "Cel: Kompleksowe porównanie EV vs benzynowe - zidentyfikować kluczowe wymiary decyzyjne",
              "Krok 1: Zdefiniować kategorie porównania - Ekonomia, Środowisko, Użytkowanie, Infrastruktura",
              "Krok 2: Ekonomia - porównać koszty zakupu vs eksploatacji, zidentyfikować punkt równowagi (TCO)",
              "Krok 3: Środowisko - rozróżnić lokalne emisje vs całościowy ślad węglowy (well-to-wheel)",
              "Krok 4: Użytkowanie - porównać parametry praktyczne: zasięg, czas ładowania/tankowania, komfort",
              "Krok 5: Infrastruktura - ocenić dostępność i gęstość sieci ładowania vs tankowania",
              "Krok 6: Synteza - połączyć wszystkie wymiary, wskazać, że decyzja zależy od profilu użytkownika",
              "Krok 7: Dodać nuanse - punkt równowagi ekonomicznej, zależność śladu CO₂ od źródła energii"
            ]
          },
          "rag": {
            "text": "Wyszukuję w bazie raportów rynkowych i technicznych...\n\n**Znaleziono 4 dokumenty:**\n\nWedług [MktAnalys-Q1-2024], **TCO dla EV jest o 8-12% niższy** w okresie 5 lat przy przebiegu powyżej 15 000 km/rok. Główne oszczędności: energia elektryczna (0.65 PLN/100km vs 45 PLN/100km benzyna) i serwis.\n\n[TechAssess-EV7] wskazuje na **54% redukcję emisji CO₂** dla EV vs benzynowe w cyklu życia pojazdu, uwzględniając polski mix energetyczny (70% węgiel).\n\n[InfraReport-2024] potwierdza, że **infrastruktura ładowania w Polsce wzrosła o 47%** w 2023 r., ale nadal jest 5x mniej punktów ładowania niż stacji benzynowych.\n\n[UserSurvey-2024] pokazuje główne obawy użytkowników EV: zasięg (68%), czas ładowania (52%), cena zakupu (71%).",
            "tokens": 98,
            "latencyMs": 880,
            "costUsd": 0.00098,
            "citations": [
              {
                "title": "Dokument wewnętrzny: MktAnalys-Q1-2024 (Analiza Rynku Automotive)",
                "snippet": "...Całkowity koszt posiadania (TCO) dla pojazdów elektrycznych w Polsce jest o 8-12% niższy w okresie 5 lat w porównaniu do benzynowych przy rocznym przebiegu >15k km. Koszty energii: EV 0.65 PLN vs benzynowe 45 PLN na 100km...",
                "url": "#"
              },
              {
                "title": "Dokument wewnętrzny: TechAssess-EV7 (Ocena Technologiczna EV)",
                "snippet": "...Analiza cyklu życia (LCA) pokazuje 54% redukcję emisji CO₂ dla EV vs pojazdy benzynowe w polskim kontekście. Uwzględnia mix energetyczny (70% węgiel), produkcję baterii, oraz recykling. Emisje: EV 8.4t vs benzynowe 18.2t CO₂ na 100k km...",
                "url": "#"
              },
              {
                "title": "Dokument wewnętrzny: InfraReport-2024 (Infrastruktura Ładowania)",
                "snippet": "...Infrastruktura ładowania w Polsce: 6,800 publicznych punktów ładowania (wzrost 47% r/r). Stacje benzynowe: 7,200. Ładowarki szybkie DC (>50kW): tylko 12% wszystkich punktów. Gęstość: 1 ładowarka na 5,600 mieszkańców...",
                "url": "#"
              },
              {
                "title": "Dokument wewnętrzny: UserSurvey-2024 (Badanie Użytkowników)",
                "snippet": "...Ankieta 2,400 potencjalnych nabywców EV. Główne obawy: cena zakupu (71%), zasięg (68%), czas ładowania (52%), deprecjacja wartości (43%). Pozytywne: koszty eksploatacji (89%), ekologia (76%), komfort jazdy (82%)...",
                "url": "#"
              }
            ]
          },
          "agent": {
            "text": "Na podstawie analizy danych rynkowych dla Polski (2024): **EV są korzystniejsze finansowo** przy przejechaniu >15k km rocznie – TCO na 5 lat to 165k PLN vs 178k PLN dla benzynowych (oszczędność 13k PLN). EV emitują o 54% mniej CO₂ i mają 3x wyższą efektywność energetyczną (85-90% vs 20-30%). Jednakże benzynowe oferują większy zasięg (600-800km vs 350-500km) i szybsze tankowanie. **Rekomendacja:** EV dla jazdy miejskiej i regularnych tras, benzynowe dla częstych długodystansowych podróży.",
            "tokens": 186,
            "latencyMs": 2100,
            "costUsd": 0.00195,
            "agentTrace": [
              {"type": "plan", "content": "Kompleksowa analiza: 1) Pobierz aktualne dane rynkowe PL, 2) Oblicz TCO na 5 lat, 3) Porównaj emisje CO₂, 4) Analizuj efektywność energetyczną, 5) Weryfikuj wszystkie obliczenia, 6) Wygeneruj rekomendacje oparte na danych"},
              {"type": "toolcall", "content": "fetch_market_data(vehicle_type=\"EV\", market=\"Poland\", year=2024, data=[\"avg_price\", \"energy_cost\", \"maintenance\"])"},
              {"type": "result", "content": "EV Polska 2024: Średnia cena zakupu: 150k PLN, koszt energii: 0.75 PLN/kWh, średnie zużycie: 15 kWh/100km, koszty serwisu: -40% vs benzynowe (niższe zużycie części, brak wymiany oleju)"},
              {"type": "toolcall", "content": "fetch_market_data(vehicle_type=\"ICE\", market=\"Poland\", year=2024, data=[\"avg_price\", \"fuel_cost\", \"maintenance\"])"},
              {"type": "result", "content": "Benzynowe Polska 2024: Średnia cena zakupu: 90k PLN, koszt paliwa: 6.50 PLN/l, średnie spalanie: 7l/100km, standardowe koszty serwisu (olej, filtry, rozrząd)"},
              {"type": "toolcall", "content": "calculate_tco(ev_data={price:150000, energy_kwh_per_100km:15, cost_per_kwh:0.75, maintenance_factor:0.6}, ice_data={price:90000, fuel_l_per_100km:7, cost_per_liter:6.5, maintenance_factor:1.0}, years=5, km_per_year=20000)"},
              {"type": "result", "content": "TCO dla 5 lat (100 000 km): EV = 165 000 PLN (zakup 150k + energia 11.25k + serwis 3.75k), ICE = 178 000 PLN (zakup 90k + paliwo 45.5k + serwis 12.5k). Oszczędność EV: 13 000 PLN (7.3%)"},
              {"type": "toolcall", "content": "emission_calculator(ev_kwh_per_km=0.15, ice_l_per_km=0.07, distance_km=100000, grid_mix=\"Poland_2024\", include_production=true)"},
              {"type": "result", "content": "Emisje dla 100k km: EV = 8.4 tony CO₂ (uwzględnia mix energetyczny Polski: 70% węgiel + produkcja baterii), ICE = 18.2 tony CO₂ (spalanie benzyny + produkcja). Redukcja emisji: 9.8 tony (54%)"},
              {"type": "toolcall", "content": "efficiency_analyzer(ev_motor_efficiency=0.9, ev_battery_efficiency=0.95, ice_engine_efficiency=0.25, ice_drivetrain_efficiency=0.85)"},
              {"type": "result", "content": "Efektywność całkowita: EV = 85.5% (motor 90% × bateria 95%), ICE = 21.3% (silnik 25% × napęd 85%). Reszta energii tracona jako ciepło. EV ~4x wydajniejsze."},
              {"type": "toolcall", "content": "validate_calculations(tco_delta=-13000, emission_reduction_percent=54, efficiency_ratio=4.0, cross_reference_sources=[\"MktAnalys-Q1\", \"TechAssess-EV7\"])"},
              {"type": "result", "content": "Walidacja ✓: Wszystkie obliczenia zgodne z danymi źródłowymi. TCO potwierdzone przez MktAnalys-Q1, emisje zgodne z TechAssess-EV7. Wyniki wiarygodne."},
              {"type": "reflection", "content": "Przeprowadziłem analizę używając 6 różnych narzędzi: pobrałem aktualne dane rynkowe dla Polski, obliczyłem szczegółowy TCO uwzględniając wszystkie koszty, zmierzyłem emisje CO₂ z lokalnym mixem energetycznym, przeanalizowałem efektywność i zwalidowałem wszystkie wyniki względem źródeł. W przeciwieństwie do RAG, który tylko cytuje ogólne stwierdzenia, dostarczam konkretnych liczb, obliczeń ROI i rekomendacji opartych na profilu użytkowania."},
              {"type": "final", "content": "Syntetyzuję odpowiedź z kluczowymi wnioskami: TCO, emisjami, efektywnością i jasną rekomendacją. Wszystkie dane zweryfikowane i obliczone, nie tylko zacytowane z dokumentów."}
            ]
          }
        },
         {
          "prompt": "Jaka jest polityka firmy dotycząca pracy zdalnej?",
          "llm": {
            "text": "Polityka pracy zdalnej różni się między firmami, ale zazwyczaj obejmuje:\n- Kwalifikacje pracowników (staż, typ stanowiska, zgoda managera)\n- Wymagania techniczne (stabilny internet, odpowiednie miejsce pracy)\n- Godziny dostępności i oczekiwania komunikacyjne\n- Zasady dotyczące bezpieczeństwa danych\n- Możliwe ograniczenia geograficzne\n\nRekomenduje się sprawdzić konkretną politykę w podręczniku pracownika lub skonsultować z działem HR, ponieważ szczegóły mogą się znacznie różnić.",
            "tokens": 48,
            "latencyMs": 420,
            "costUsd": 0.00048
          },
          "reasoning": {
            "text": "Strukturyzując typową politykę pracy zdalnej:\n\n**1. Kwalifikacje pracowników:**\n- Pracownicy pełnoetatowi po okresie próbnym (zazwyczaj 3-6 miesięcy)\n- Stanowiska umożliwiające pracę zdalną (biurowe, IT, niewymagające fizycznej obecności)\n- Pozytywna ocena roczna i zgoda bezpośredniego przełożonego\n- Możliwy wymóg minimalnego stażu w firmie\n\n**2. Wymagania techniczne i organizacyjne:**\n- Stabilne łącze internetowe (min. 25-50 Mbps)\n- Dedykowane miejsce pracy spełniające normy BHP\n- Obowiązkowe godziny dostępności (np. core hours 10:00-15:00)\n- Narzędzia komunikacji: VPN, Teams/Slack, dostęp do systemów firmowych\n\n**3. Bezpieczeństwo i compliance:**\n- Protokoły bezpieczeństwa danych (szyfrowanie, VPN obowiązkowy)\n- RODO i ochrona danych klientów\n- Zakaz pracy w przestrzeniach publicznych (kawiarnie, coworking bez zgody)\n\n**4. Lokalizacja:**\n- Ograniczenia geograficzne ze względów podatkowych i prawnych\n- Typowo: kraj siedziby firmy lub zatwierdzone lokalizacje w UE\n- Praca spoza UE wymaga specjalnych procedur\n\n**5. Proces aplikacji:**\n- Wniosek pracownika → analiza managera → akceptacja HR → setup IT → okres próbny\n\n**Konkluzja:** Polityka balansuje między elastycznością dla pracownika a wymogami bezpieczeństwa, compliance i operacyjnymi firmy.",
            "tokens": 168,
            "latencyMs": 850,
            "costUsd": 0.00168,
            "reasoningTrace": [
              "Cel: Zdefiniować typową strukturę polityki pracy zdalnej firmy",
              "Krok 1: Zidentyfikować główne komponenty polityki - Kwalifikacje, Wymagania, Bezpieczeństwo, Lokalizacja, Proces",
              "Krok 2: Kwalifikacje - rozłożyć na: typ umowy, rodzaj stanowiska, performance, staż, zgody",
              "Krok 3: Wymagania tech/org - określić minimalne parametry: internet, miejsce pracy, core hours, narzędzia",
              "Krok 4: Bezpieczeństwo - uwzględnić wymogi RODO, ochrony danych, protokoły dostępu",
              "Krok 5: Lokalizacja - wyjaśnić ograniczenia geograficzne (podatki, prawo pracy, compliance)",
              "Krok 6: Proces - zdefiniować przepływ od wniosku do akceptacji",
              "Krok 7: Synteza - połączyć wszystkie elementy w spójną politykę balansującą elastyczność i ryzyka"
            ]
          },
          "rag": {
            "text": "Przeszukuję oficjalne dokumenty HR w bazie wiedzy...\n\n**Znaleziono 3 dokumenty:**\n\n**[HRManual-Sec4.B]** - Polityka pracy zdalnej:\n- Kwalifikacje: pełny etat, min. **6 miesięcy stażu**, zgoda managera\n- Stanowiska kwalifikujące się: IT (100%), Marketing (95%), Finanse (80%), HR (90%)\n- Proces: formularz WFH-01 → akceptacja managera (3 dni) → IT setup (5 dni)\n\n**[RemoteGuide-v3]** - Wymagania techniczne:\n- Internet: min. **50/10 Mbps** (weryfikowane przez IT)\n- VPN: **Cisco AnyConnect** (obowiązkowy)\n- Core hours: **10:00-16:00 CET** (obowiązkowa dostępność)\n- Sprzęt: laptop + monitor firmowy (dostarcza IT)\n\n**[CompliancePolicy-v2.1]** - Restrykcje lokalizacyjne:\n- Dozwolone bez zgody: **PL, DE, NL, CZ**\n- Inne kraje UE: wymaga zgody Legal (case-by-case)\n- Poza UE: **zabronione** (RODO, compliance)\n\nAktualna adopcja: **67% zespołu pracuje zdalnie** (dane Q4 2024)",
            "tokens": 112,
            "latencyMs": 850,
            "costUsd": 0.00112,
            "citations": [
              {
                "title": "Dokument wewnętrzny: HRManual-Sec4.B v2.3 (Polityka Pracy Zdalnej)",
                "snippet": "...§4.B Polityka Work From Home. Kwalifikacje: (1) pracownicy pełnoetatowi z min. 6 mies. stażu, (2) pozytywna ocena roczna min. 'spełnia oczekiwania', (3) zgoda bezpośredniego managera. Stanowiska: IT 100%, Marketing 95%, Finanse 80%, HR 90% zespołu kwalifikuje się. Proces: WFH-01 form → manager approval (SLA 3 dni) → IT setup...",
                "url": "#"
              },
              {
                "title": "Dokument wewnętrzny: RemoteGuide-v3 (Wytyczne Pracy Zdalnej)",
                "snippet": "...§3 Wymagania techniczne. Internet: minimum 50 Mbps download / 10 Mbps upload (IT przeprowadza test). VPN: obowiązkowe Cisco AnyConnect dla dostępu do zasobów firmowych. Core hours: 10:00-16:00 CET obowiązkowa dostępność + elastyczne 2h w oknie 7:00-20:00. Sprzęt: laptop Dell XPS/Lenovo ThinkPad + monitor 27\" (dostarcza dział IT w ciągu 5 dni roboczych)...",
                "url": "#"
              },
              {
                "title": "Dokument wewnętrzny: CompliancePolicy-v2.1 §4.2 (Lokalizacja)",
                "snippet": "...§4.2 Geograficzne ograniczenia pracy zdalnej. Tier 1 (dozwolone bez dodatkowej zgody): Polska, Niemcy, Holandia, Czechy - weryfikacja podatkowa + payroll agreement. Tier 2 (wymaga Legal approval): pozostałe kraje UE/EOG, ocena case-by-case (podatki, insurance, labor law). Tier 3 (zabronione): poza UE ze względu na RODO Article 44-50, data transfer restrictions, compliance risks...",
                "url": "#"
              }
            ]
          },
          "agent": {
            "text": "Na podstawie aktualnych dokumentów HR (wrzesień 2024): pracownicy pełnoetatowi z min. 6 mies. stażem mogą pracować zdalnie po uzyskaniu zgody managera. **Kwalifikują się stanowiska:** IT, Marketing, Finanse, HR (88% zespołu). **Wymagania:** Internet 50/10 Mbps, VPN Cisco AnyConnect, dostępność 10:00-16:00 CET. **Lokalizacja:** PL, DE, NL, CZ dozwolone; inne kraje UE wymagają zgody Legal; spoza UE zakazane (RODO). **Proces:** WFH-01 form → akceptacja (3 dni) → IT setup (5 dni) → trial (3 mies.). Obecnie 67% zespołu pracuje zdalnie.",
            "tokens": 248,
            "latencyMs": 2350,
            "costUsd": 0.00260,
            "agentTrace": [
              {"type": "plan", "content": "Kompleksowa analiza: 1) Parsuj HRManual-Sec4.B (kwalifikacje, proces), 2) Parsuj RemoteGuide-v3 (wymagania tech), 3) Cross-reference z Compliance (lokalizacje), 4) Wyodrębnij konkretne §, 5) Sprawdź wersje dokumentów, 6) Pobierz statystyki adopcji, 7) Waliduj spójność między politykami"},
              {"type": "toolcall", "content": "document_parser(doc_id=\"HRManual-Sec4.B\", extract_sections=[\"eligibility\", \"application_process\", \"requirements\"], version=\"latest\", output_format=\"structured\")"},
              {"type": "result", "content": "HRManual-Sec4.B v2.3 (data publikacji: 2024-09-15): §2.1 Kwalifikacje - pracownicy pełnoetatowi, min. 6 miesięcy stażu, zgoda bezpośredniego managera, pozytywna ocena roczna (min. 'spełnia oczekiwania'). Lista stanowisk kwalifikowanych: IT (100%), Marketing (95%), Finanse (80%), HR (90%) - łącznie 88% zespołu."},
              {"type": "toolcall", "content": "document_parser(doc_id=\"RemoteGuide-v3\", extract_sections=[\"technical_requirements\", \"working_hours\", \"equipment_provision\"], version=\"latest\")"},
              {"type": "result", "content": "RemoteGuide-v3 (aktualizacja: 2024-08): §3 Wymagania techniczne - Internet: minimum 50 Mbps download / 10 Mbps upload (weryfikowane przez IT), VPN: obowiązkowe Cisco AnyConnect, Sprzęt: laptop + monitor firmowy (dostarcza dział IT), Backup: zalecany hotspot mobilny. Core hours: 10:00-16:00 CET (obowiązkowa dostępność), flextime: pozostałe 2h w oknie 7:00-20:00."},
              {"type": "toolcall", "content": "cross_reference_check(source_docs=[\"HRManual-Sec4.B\", \"RemoteGuide-v3\", \"CompliancePolicy-v2.1\"], field=\"geographical_restrictions\", validate_consistency=true)"},
              {"type": "result", "content": "Compliance Policy §4.2 'Lokalizacja pracy zdalnej': Dozwolone bez dodatkowej zgody: Polska, Niemcy, Holandia, Czechy (weryfikacja podatkowa + umowa z lokalnym payroll). Pozostałe kraje UE: wymagana zgoda działu Legal i Compliance (case-by-case). Spoza UE: zabronione ze względu na RODO i wymogi compliance. Cross-reference ✓ - wszystkie 3 dokumenty spójne."},
              {"type": "toolcall", "content": "extract_process_flow(document=\"HRManual-Sec4.B\", section=\"remote_work_application\", include_timelines=true, include_stakeholders=true)"},
              {"type": "result", "content": "Proces aplikacji o pracę zdalną: Krok 1 - Wypełnienie formularza WFH-01 (Work From Home Application), Krok 2 - Manager review i decyzja (SLA: 3 dni robocze), Krok 3 - Po akceptacji: automatyczne zgłoszenie do IT setup (SLA: 5 dni na dostawę sprzętu + konfiguracja VPN), Krok 4 - Obowiązkowe szkolenie bezpieczeństwa online (2h, platforma LMS), Krok 5 - Trial period: 3 miesiące z review po 6 tygodniach."},
              {"type": "toolcall", "content": "get_statistics(metric=\"remote_work_adoption_rate\", breakdown=[\"by_department\", \"by_work_model\"], timeframe=\"Q4_2024\", include_trends=true)"},
              {"type": "result", "content": "Statystyki adopcji pracy zdalnej Q4 2024: Ogółem: 67% pracowników (full remote: 23%, hybrid: 44%, office: 33%). Wzrost r/r: +12%. Breakdown: IT 95% remote/hybrid, Marketing 78%, Finanse 61%, HR 85%, Operations 31%. Trend: stabilizacja po wzroście w 2023."},
              {"type": "toolcall", "content": "policy_validator(policies=[\"HRManual-Sec4.B\", \"RemoteGuide-v3\", \"CompliancePolicy-v2.1\"], checks=[\"version_currency\", \"cross_conflicts\", \"legal_compliance\"])"},
              {"type": "result", "content": "Walidacja polityk: ✓ Wersje aktualne (HRManual: 09/2024, RemoteGuide: 08/2024, Compliance: 07/2024), ✓ Brak konfliktów między dokumentami, ✓ Zgodność z RODO i polskim prawem pracy, ✓ Wszystkie polityki zatwierdzone przez Legal. Kolejna rewizja zaplanowana: Q1 2025."},
              {"type": "reflection", "content": "Wykonałem dogłębną analizę używając 6 specjalistycznych narzędzi: parsowałem 3 dokumenty HR wydobywając konkretne paragrafy i wersje, sprawdziłem cross-reference dla zapewnienia spójności lokalizacji między politykami, wyekstrahowałem szczegółowy proces z timeline'ami i SLA, pobrałem aktualne statystyki adopcji z breakdown'em, oraz zwalidowałem wszystkie polityki pod kątem aktualności i zgodności prawnej. W przeciwieństwie do RAG który tylko cytuje fragmenty dokumentów, dostarczam zweryfikowane, strukturalne informacje z konkretnymi referencjami do paragrafów, timeline'ami procesu i kontekstem ilościowym."},
              {"type": "final", "content": "Syntetyzuję kompletną odpowiedź obejmującą: kwalifikacje z konkretnym §, szczegółowe wymagania techniczne, restrykcje lokalizacyjne z podstawą prawną, pełny proces aplikacji z SLA, i statystyki adopcji - wszystko zweryfikowane i ze źródłami, nie tylko zacytowane."}
            ]
          }
        }
      ],
      "defaultAnswer": {
        "text": "Nie mam konkretnych symulowanych danych dla tego zapytania. Proszę wybrać jedno z przykładowych zapytań, aby zobaczyć porównanie.",
        "tokens": 21,
        "latencyMs": 300,
        "costUsd": 0.00015
      }
    }
    </script>

    <script>
        // --- DOM Element References ---
        // Get references to necessary HTML elements
        const qData = JSON.parse(document.getElementById('questionData').textContent); // Parse the corrected JSON
        const promptInput = document.getElementById('promptInput');
        const sendBtn = document.getElementById('sendBtn');
        const chatContainer = document.getElementById('chatContainer');
        const alertBox = document.getElementById('alert');
        const promptSelect = document.getElementById('promptSelect');

        // --- Paradigm Definitions with Icons and Descriptions ---
        // Define the different chatbot types to simulate
        const paradigms = [
            {
                key: 'llm',
                label: 'Chat LLM',
                color: 'bg-gradient-to-br from-purple-50 to-pink-50', // Background color class
                iconSvg: `<svg class="inline-icon w-6 h-6 text-purple-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 0 0 2.25-2.25V8.25a2.25 2.25 0 0 0-2.25-2.25H6.75A2.25 2.25 0 0 0 4.5 8.25v10.5A2.25 2.25 0 0 0 6.75 21H9" /></svg>`,
                description: 'Generuje tekst bezpośrednio z obszernych danych treningowych.'
            },
            {
                key: 'reasoning',
                label: 'Chat z rozumowaniem',
                color: 'bg-gradient-to-br from-emerald-50 to-teal-50',
                iconSvg: `<svg class="inline-icon w-6 h-6 text-emerald-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.43.992a6.759 6.759 0 0 1 0 1.903c.008.378.137.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.6 6.6 0 0 1-.22.128c-.332.183-.582.495-.644.869l-.213 1.28c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.759 6.759 0 0 1 0-1.903c-.007-.378-.137-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582.495.644-.869l.214-1.28Z" /></svg>`,
                description: 'Wykorzystuje wewnętrzne kroki logiczne lub planowanie przed odpowiedzią.'
            },
            {
                key: 'rag',
                label: 'Chat RAG',
                color: 'bg-gradient-to-br from-sky-50 to-blue-50',
                iconSvg: `<svg class="inline-icon w-6 h-6 text-sky-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607ZM10.5 7.5v6m3-3h-6" /></svg>`,
                description: 'Najpierw wyszukuje informacje ze zdefiniowanej bazy wiedzy.'
            },
            {
                key: 'agent',
                label: 'Chat Agent',
                color: 'bg-gradient-to-br from-amber-50 to-orange-50',
                iconSvg: `<svg class="inline-icon w-6 h-6 text-amber-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17 17.25 21A2.652 2.652 0 0 0 21 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 1 1-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 0 0 4.486-6.336l-3.276 3.277a3.004 3.004 0 0 1-2.25-2.25l3.276-3.276a4.5 4.5 0 0 0-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437 1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008Z" /></svg>`,
                description: 'Wykorzystuje narzędzia i przechodzi przez etapy: plan, akcja, refleksja.'
            }
        ];

        // --- Function to Populate Sample Prompts Dropdown ---
        function populatePrompts() {
            // Clear existing options before adding new ones
            promptSelect.innerHTML = '';
            // Create and add a placeholder option
            const placeholderOption = document.createElement('option');
            placeholderOption.textContent = '-- Wybierz przykładowe zapytanie --';
            placeholderOption.value = ""; // Empty value for placeholder
            placeholderOption.disabled = true;
            placeholderOption.selected = true;
            promptSelect.appendChild(placeholderOption);

            // Add an option for each question in the data
            qData.questions.forEach(q => {
                const option = document.createElement('option');
                option.value = q.prompt; // Set the value to the prompt text
                option.textContent = q.prompt; // Set the display text
                promptSelect.appendChild(option);
            });
            console.log("Prompts populated."); // Debug log
        }


        // --- Function to Create an Individual Chat Pane ---
        function createPane(paradigm) {
            const paneDiv = document.createElement('div');
            // Apply styling for the chat pane using Tailwind classes
            paneDiv.className = `${paradigm.color} p-5 rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 flex flex-col border-2 border-gray-200 min-h-[320px] transform hover:-translate-y-1`;
            // Set inner HTML structure for the pane (header, output area, metrics area)
            paneDiv.innerHTML = `
                <div class="flex-shrink-0 border-b-2 border-gray-200 pb-3 mb-3">
                    <h2 class="font-bold mb-2 text-xl text-gray-900 flex items-center gap-2">${paradigm.iconSvg}${paradigm.label}</h2>
                    <p class="text-sm text-gray-600 leading-relaxed">${paradigm.description}</p>
                </div>
                <div class="flex-grow overflow-y-auto text-gray-800 leading-relaxed mb-3 text-sm" data-output></div>
                <div class="flex-shrink-0 text-xs text-gray-600 mt-auto border-t-2 border-gray-200 pt-3 font-medium" data-metrics></div> `;
            return paneDiv;
        }

        // --- Function to Render Typing Output ---
        function renderOutput(outputContainer, answerData, mode) {
            outputContainer.textContent = ''; // Clear previous content
            // Split text carefully by newline, bold markdown, or LaTeX, preserving delimiters
            const segments = answerData.text.split(/(\n|\*\*.*?\*\*|\$.*?\$)/).filter(Boolean);
            let segmentIndex = 0;
            const span = document.createElement('span'); // Use a span for the typing effect
            outputContainer.appendChild(span);
            span.classList.add('typing'); // Add typing cursor class

            // Calculate delay per segment for the typing animation
            const totalDuration = answerData.latencyMs * 0.7; // Use 70% of latency for typing effect
            const delayPerSegment = Math.max(30, totalDuration / Math.max(segments.length, 1)); // Minimum 30ms delay

            // Interval timer to append segments one by one
            const intervalId = setInterval(() => {
                if (segmentIndex < segments.length) {
                    let currentSegment = segments[segmentIndex];
                    // Handle different segment types (newline, bold, LaTeX, plain text)
                    if (currentSegment === '\n') {
                        span.innerHTML += '<br>';
                    } else if (currentSegment.startsWith('**') && currentSegment.endsWith('**')) {
                        span.innerHTML += `<strong>${currentSegment.slice(2, -2)}</strong>`; // Render bold
                    } else if (currentSegment.startsWith('$') && currentSegment.endsWith('$')) {
                        span.innerHTML += currentSegment; // Keep LaTeX as is for MathJax
                    } else {
                        span.textContent += currentSegment; // Append regular text
                    }
                    segmentIndex++;
                } else {
                    // Typing finished
                    span.classList.remove('typing'); // Remove typing cursor
                    clearInterval(intervalId); // Stop the interval

                    // Add reasoning or citations sections *after* typing finishes
                    // These are added to the parent container of the output div
                    if (mode === 'reasoning' && answerData.reasoningTrace) {
                        addReasoning(outputContainer.parentNode, answerData.reasoningTrace);
                    }
                    if (mode === 'rag' && answerData.citations) {
                        addCitations(outputContainer.parentNode, answerData.citations);
                    }
                    if (mode === 'agent' && answerData.agentTrace) {
                        addAgentTrace(outputContainer.parentNode, answerData.agentTrace);
                    }

                    // Trigger MathJax typesetting if available
                    if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
                        MathJax.typesetPromise([outputContainer]).catch(function (err) {
                           console.error('MathJax typesetting error:', err); // Log errors
                        });
                    }
                }
            }, delayPerSegment);
        }


        // --- Function to Add Reasoning Steps Section ---
        function addReasoning(container, trace) {
            // Remove existing reasoning section first to prevent duplicates
            const existingDetails = container.querySelector('.reasoning-details');
            if (existingDetails) existingDetails.remove();

            // Create details/summary element for accordion effect
            const details = document.createElement('details');
            details.className = 'reasoning-details mt-3 text-sm border-t border-green-200 pt-2 bg-green-50 p-3 rounded'; // Styling
            // Summary text with an icon
            details.innerHTML = '<summary class="font-medium text-green-800 cursor-pointer text-base mb-1 flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z" /></svg>Kroki rozumowania</summary>';
            // Create ordered list for the steps
            const list = document.createElement('ol');
            list.className = 'list-decimal list-inside text-green-900 mt-1 space-y-1 pl-2';
            trace.forEach(step => {
                const item = document.createElement('li');
                item.innerHTML = step.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); // Support bold markdown in steps
                list.appendChild(item);
            });
            details.appendChild(list);
            // Insert the reasoning section before the metrics div
            container.insertBefore(details, container.querySelector('[data-metrics]'));
        }

        // --- Function to Add Citations Section ---
        function addCitations(container, citations) {
             // Remove existing citation section first
            const existingCitations = container.querySelector('.citation-section');
            if (existingCitations) existingCitations.remove();

            // Create div for the citation section
            const citationDiv = document.createElement('div');
            citationDiv.className = 'citation-section mt-3 space-y-2 text-xs border-t border-blue-200 pt-2 bg-blue-50 p-3 rounded'; // Styling
            // Title with an icon
            const title = document.createElement('h4');
            title.className = 'font-medium text-blue-800 mb-2 text-sm flex items-center gap-1';
            title.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" /></svg>Bibliografia';
            citationDiv.appendChild(title);

            // Add each citation as a paragraph
            citations.forEach(cit => {
                const p = document.createElement('p');
                p.className = 'text-blue-900';
                // Format citation with title, snippet, and link
                p.innerHTML = `<span class="font-semibold">${cit.title}:</span> "${cit.snippet}" <a href="${cit.url || '#'}" target="_blank" rel="noopener noreferrer" class="text-blue-600 underline hover:text-blue-800">[Link]</a>`;
                citationDiv.appendChild(p);
            });
             // Insert the citation section before the metrics div
            container.insertBefore(citationDiv, container.querySelector('[data-metrics]'));
        }

        // --- Function to Add Agent Trace Section ---
        function addAgentTrace(container, trace) {
            // Remove existing agent trace section first
            const existingTrace = container.querySelector('.agent-trace-section');
            if (existingTrace) existingTrace.remove();

            // Create details/summary element for accordion effect
            const details = document.createElement('details');
            details.className = 'agent-trace-section mt-3 text-sm border-t border-orange-200 pt-2 bg-orange-50 p-3 rounded';
            // Summary text with an icon
            details.innerHTML = '<summary class="font-medium text-orange-800 cursor-pointer text-base mb-1 flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.43.992a6.759 6.759 0 0 1 0 1.903c.008.378.137.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.6 6.6 0 0 1-.22.128c-.332.183-.582.495-.644.869l-.213 1.28c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.759 6.759 0 0 1 0-1.903c-.007-.378-.137-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582.495.644-.869l.214-1.28Z" /></svg>Proces przygotowania odpowiedzi</summary>';

            // Create list for the steps
            const list = document.createElement('div');
            list.className = 'space-y-2 mt-2';

            // Define icons and labels for each step type
            const typeConfig = {
                'plan': { icon: '📋', label: 'Plan', color: 'text-orange-900 bg-orange-100', border: 'border-orange-300' },
                'toolcall': { icon: '🔧', label: 'Wywołanie narzędzia', color: 'text-blue-900 bg-blue-100', border: 'border-blue-300' },
                'result': { icon: '✓', label: 'Wynik', color: 'text-green-900 bg-green-100', border: 'border-green-300' },
                'reflection': { icon: '💭', label: 'Refleksja', color: 'text-purple-900 bg-purple-100', border: 'border-purple-300' },
                'final': { icon: '🎯', label: 'Finalizacja', color: 'text-red-900 bg-red-100', border: 'border-red-300' }
            };

            trace.forEach(step => {
                const config = typeConfig[step.type] || { icon: '•', label: step.type, color: 'text-gray-900 bg-gray-100', border: 'border-gray-300' };
                const stepDiv = document.createElement('div');
                stepDiv.className = `p-2 rounded border ${config.border} ${config.color}`;
                stepDiv.innerHTML = `<div class="font-semibold text-xs mb-1">${config.icon} ${config.label}</div><div class="text-xs">${step.content}</div>`;
                list.appendChild(stepDiv);
            });

            details.appendChild(list);
            // Insert the agent trace section before the metrics div
            container.insertBefore(details, container.querySelector('[data-metrics]'));
        }


        // --- Function to Render Metrics ---
        function renderMetrics(metricsContainer, answerData) {
            // Display tokens, latency, and estimated cost
            metricsContainer.textContent = `Tokeny: ${answerData.tokens} | Opóźnienie: ${answerData.latencyMs} ms | Szac. koszt: $${answerData.costUsd.toFixed(5)}`;
        }

        // --- Main Function to Handle Sending Prompt ---
        function send() {
            console.log("Send function triggered."); // Debug log
            const promptText = promptInput.value.trim();
            // Check if prompt is empty
            if (!promptText) {
                alertBox.textContent = 'Proszę wprowadzić zapytanie lub wybrać przykład.';
                alertBox.classList.remove('hidden'); // Show alert
                // Ensure alert is red for error
                alertBox.classList.remove('bg-yellow-100', 'text-yellow-800', 'border-yellow-300');
                alertBox.classList.add('bg-red-100', 'text-red-700', 'border-red-300');
                return;
            }

            // Find matching question data (case-insensitive comparison)
            const exactMatch = qData.questions.find(q => q.prompt.toLowerCase() === promptText.toLowerCase());
            const usingDefault = !exactMatch; // Flag if using default answer
            // Use matched data or the default answer structure
            const dataToShow = exactMatch || {
                llm: qData.defaultAnswer,
                reasoning: qData.defaultAnswer,
                rag: qData.defaultAnswer
            };

            // Clear previous results and hide any existing alert
            chatContainer.innerHTML = '';
            alertBox.classList.add('hidden');

            // Show informational alert if using the default answer set
            if (usingDefault) {
                alertBox.textContent = 'Zapytanie nie znalezione w przykładach - pokazuję domyślną symulację odpowiedzi.';
                alertBox.classList.remove('hidden');
                // Style alert as informational (yellow)
                alertBox.classList.remove('bg-red-100', 'text-red-700', 'border-red-300');
                alertBox.classList.add('bg-yellow-100', 'text-yellow-800', 'border-yellow-300');
            }

            // Create and populate panes for each defined paradigm
            paradigms.forEach(paradigm => {
                const pane = createPane(paradigm); // Create the pane structure
                chatContainer.appendChild(pane); // Add pane to the grid

                // Get references to the output and metrics divs within the new pane
                const outputDiv = pane.querySelector('[data-output]');
                const metricsDiv = pane.querySelector('[data-metrics]');
                // Get the specific answer data for this paradigm
                const answer = dataToShow[paradigm.key];

                // Use setTimeout to allow the UI to update before starting animation/metrics rendering
                // This prevents the UI from freezing briefly on potentially slow operations
                setTimeout(() => {
                    renderOutput(outputDiv, answer, paradigm.key); // Start typing animation
                    renderMetrics(metricsDiv, answer); // Display metrics
                }, 50); // Small delay (50ms)
            });

            // Reset dropdown selection if a custom prompt was entered that wasn't a sample
            if (promptSelect.value.toLowerCase() !== promptText.toLowerCase()) {
                 if(promptSelect.options.length > 0) { // Check if options exist
                    promptSelect.selectedIndex = 0; // Reset to the placeholder option
                 }
            }
        }

        // --- Event Listeners for User Interaction ---

        // Send button click
        sendBtn.addEventListener('click', send);

        // Enter key press in the input field
        promptInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault(); // Prevent default form submission if applicable
                send();
            }
        });

        // Sample Prompt Selection Change
         promptSelect.addEventListener('change', () => {
            console.log("Dropdown changed. Selected value:", promptSelect.value); // Debug log
            if (promptSelect.value) { // Only proceed if a valid (non-placeholder) option is selected
                promptInput.value = promptSelect.value; // Update the text input
                promptInput.focus(); // Focus the text input
                send(); // Automatically send the selected prompt
            }
        });


        // --- Initialization ---
        // Populate the prompts dropdown immediately when the script runs
        populatePrompts();

    </script>
</body>
</html>
