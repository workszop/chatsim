<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Symulator Paradygmat√≥w Chatbot√≥w</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configure MathJax
        window.MathJax = {
          tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']] // Define inline math delimiters
          },
          svg: {
            fontCache: 'global'
          }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
    <style>
        /* Custom CSS for typing animation */
        .typing {
            border-right: 2px solid;
            animation: blink .7s steps(1) infinite;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        @keyframes blink {
            50% { border-color: transparent; }
        }
        /* Style for the details summary (accordion trigger) */
        summary { cursor: pointer; }
        /* Ensure icons align nicely with text */
        svg.inline-icon {
            display: inline-block;
            vertical-align: middle;
            margin-right: 0.5rem;
        }
        /* Ensure body takes full height for footer positioning */
        html, body {
            height: 100%;
        }
        body {
            display: flex;
            flex-direction: column;
        }
        main {
            flex-grow: 1; /* Allow main content to fill space */
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">

    <header class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white shadow-md sticky top-0 z-10">
        <div class="container mx-auto px-4 py-4">
            <h1 class="text-3xl font-bold">Symulator Paradygmat√≥w Chatbot√≥w</h1>
            <p class="text-indigo-100 mt-1 text-sm">
                Odkryj, jak r√≥≈ºne podej≈õcia chatbot√≥w radzƒÖ sobie z tym samym zapytaniem.
            </p>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-6 lg:p-8 flex flex-col items-center">

        <p class="text-center text-gray-600 mb-6 max-w-3xl">
            Por√≥wnaj standardowy Du≈ºy Model Jƒôzykowy (LLM), model wykorzystujƒÖcy wewnƒôtrzne rozumowanie oraz model u≈ºywajƒÖcy Generowania Wspomaganego Wyszukiwaniem (RAG) z dostƒôpem do okre≈õlonej bazy wiedzy (np. dokumenty wewnƒôtrzne).
        </p>

        <div class="w-full max-w-4xl flex flex-col gap-2 mb-6 bg-white p-5 rounded-lg shadow-md border border-gray-200">
            <label for="promptSelect" class="text-sm font-medium text-gray-700">Wybierz przyk≈Çadowe zapytanie:</label>
            <select id="promptSelect" class="p-2 rounded border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out"></select>
            <div class="flex flex-col sm:flex-row gap-2 mt-2">
                <input id="promptInput" class="flex-1 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out" placeholder="Lub wpisz w≈Çasne pytanie...">
                <button id="sendBtn" class="bg-blue-600 text-white px-6 py-2 rounded font-semibold hover:bg-blue-700 active:bg-blue-800 transition-colors duration-200 shadow-sm flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
                    </svg>
                    Wy≈õlij
                </button>
            </div>
        </div>

        <div id="alert" class="hidden text-red-700 mb-4 font-medium p-3 bg-red-100 border border-red-300 rounded w-full max-w-4xl text-sm"></div>

        <div id="chatContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5 w-full max-w-7xl">
            </div>

    </main>

    <footer class="bg-gray-800 text-gray-300 text-center p-4 mt-8 shadow-inner">
        <div class="container mx-auto text-sm">
            &copy; 2024 Symulator Chatbot√≥w. Wszelkie prawa zastrze≈ºone.
        </div>
    </footer>

    <script id="questionData" type="application/json">
    {
      "questions": [
        {
          "prompt": "Wyja≈õnij proces fotosyntezy",
          "llm": {
            "text": "Fotosynteza to proces biologiczny, w kt√≥rym ro≈õliny, glony i niekt√≥re bakterie przekszta≈ÇcajƒÖ energiƒô ≈õwietlnƒÖ, wodƒô i CO2 w glukozƒô (pokarm) oraz tlen. Jest kluczowa dla ≈ºycia.",
            "tokens": 30,
            "latencyMs": 400,
            "costUsd": 0.00030
          },
          "reasoning": {
            "text": "Aby logicznie wyja≈õniƒá fotosyntezƒô:\nSk≈Çada siƒô z dw√≥ch g≈Ç√≥wnych etap√≥w.\n1.  **Reakcje ≈õwietlne:** PrzechwytujƒÖ energiƒô s≈ÇonecznƒÖ za pomocƒÖ chlorofilu, produkujƒÖc ATP i NADPH.\n2.  **Cykl Calvina:** Wykorzystuje ATP i NADPH do przekszta≈Çcenia CO2 w cukry (glukozƒô).\nTa sekwencja przekszta≈Çca energiƒô ≈õwietlnƒÖ w energiƒô chemicznƒÖ.",
            "tokens": 55,
            "latencyMs": 600,
            "costUsd": 0.00055,
            "reasoningTrace": [
              "Cel: Wyja≈õniƒá fotosyntezƒô",
              "Podzia≈Ç: Zidentyfikowaƒá kluczowe komponenty (wej≈õcia, proces, wyj≈õcia)",
              "Szczeg√≥≈Çy procesu: Podzieliƒá na g≈Ç√≥wne etapy (Reakcje ≈õwietlne, Cykl Calvina)",
              "Podsumowanie etapu 1: Energia ≈õwietlna -> No≈õniki chemiczne (ATP, NADPH)",
              "Podsumowanie etapu 2: No≈õniki chemiczne + CO2 -> Cukry",
              "Synteza: Po≈ÇƒÖczyƒá podsumowania etap√≥w w sp√≥jne wyja≈õnienie przekszta≈Çcenia energii."
            ]
          },
          "rag": {
            "text": "Sprawdzam wewnƒôtrznƒÖ bazƒô wiedzy biologicznej:\nFotosynteza zachodzi w chloroplastach [Ref. dok.: BioKB-123]. Proces przebiega wed≈Çug r√≥wnania $6CO_2 + 6H_2O \\xrightarrow{≈öwiat≈Ço} C_6H_{12}O_6 + 6O_2$ [Ref. dok.: SciencePrimer-Chap4]. Jest fundamentalna dla przep≈Çywu energii w ekosystemie.",
            "tokens": 48,
            "latencyMs": 780,
            "costUsd": 0.00070,
            "citations": [
              {
                "title": "Dokument wewnƒôtrzny: BioKB-123",
                "snippet": "Sekcja dotyczƒÖca organelli kom√≥rkowych opisuje funkcjƒô chloroplast√≥w w fotosyntezie...",
                "url": "#"
              },
               {
                "title": "Dokument wewnƒôtrzny: SciencePrimer-Chap4",
                "snippet": "Rozdzia≈Ç 4 szczeg√≥≈Çowo opisuje r√≥wnanie chemiczne i zasady przekszta≈Çcania energii...",
                "url": "#"
              }
            ]
          },
          "agent": {
            "text": "**Fotosynteza - Kompleksowe wyja≈õnienie:**\nFotosynteza to dwuetapowy proces biochemiczny zachodzƒÖcy w chloroplastach:\n\n**1. Reakcje ≈õwietlne (tylakoidy):** Chlorofil poch≈Çania fotony ≈õwiat≈Ça (g≈Ç√≥wnie 680nm i 700nm), co inicjuje fotolizƒô wody. Powstaje ATP, NADPH i O‚ÇÇ.\n\n**2. Cykl Calvina (stroma):** Energia z ATP i NADPH s≈Çu≈ºy do wiƒÖzania CO‚ÇÇ w cyklu C3, tworzƒÖc glukozƒô ($C_6H_{12}O_6$).\n\n**R√≥wnanie sumaryczne:** $6CO_2 + 6H_2O \\xrightarrow{≈öwiat≈Ço} C_6H_{12}O_6 + 6O_2$\n\n**Efektywno≈õƒá:** ~3-6% energii s≈Çonecznej konwertowane na energiƒô chemicznƒÖ. Wydajno≈õƒá zale≈ºy od intensywno≈õci ≈õwiat≈Ça, temperatury i dostƒôpno≈õci CO‚ÇÇ.",
            "tokens": 142,
            "latencyMs": 1850,
            "costUsd": 0.00155,
            "agentTrace": [
              {"type": "plan", "content": "Strategia: 1) Pobierz definicjƒô z bazy wiedzy, 2) Weryfikuj r√≥wnanie chemiczne, 3) Znajd≈∫ szczeg√≥≈Çy etap√≥w, 4) Oblicz efektywno≈õƒá, 5) Zsyntetyzuj kompletnƒÖ odpowied≈∫"},
              {"type": "toolcall", "content": "search_knowledge_base(query=\"fotosynteza definicja proces\", sources=[\"BioKB-123\", \"SciencePrimer\"])"},
              {"type": "result", "content": "Znaleziono 3 dokumenty: Fotosynteza to proces konwersji energii ≈õwietlnej w chemicznƒÖ, zachodzi w chloroplastach..."},
              {"type": "toolcall", "content": "formula_validator(formula=\"6CO2 + 6H2O -> C6H12O6 + 6O2\", check_balance=true)"},
              {"type": "result", "content": "R√≥wnanie zbilansowane ‚úì. Atomy: C:6‚Üí6, H:12‚Üí12, O:18‚Üí18"},
              {"type": "toolcall", "content": "search_knowledge_base(query=\"reakcje ≈õwietlne vs cykl Calvina\", depth=\"detailed\")"},
              {"type": "result", "content": "Reakcje ≈õwietlne w tylakoidach: fotosystemy I i II, fotoliza wody, produkcja ATP/NADPH. Cykl Calvina w stromie: fiksacja CO‚ÇÇ, cykl C3"},
              {"type": "toolcall", "content": "calculate_efficiency(input_energy=\"solar\", output_energy=\"chemical_glucose\", process=\"photosynthesis\")"},
              {"type": "result", "content": "Efektywno≈õƒá fotosyntezy: 3-6% w warunkach optymalnych, zale≈ºy od PAR (Photosynthetically Active Radiation)"},
              {"type": "reflection", "content": "Zebra≈Çem: definicjƒô, zweryfikowane r√≥wnanie, szczeg√≥≈Çy obu etap√≥w i dane o efektywno≈õci. Mam kompletny obraz naukowy. RAG poda≈Ç tylko podstawy - ja dostarczam g≈ÇƒôbszƒÖ analizƒô z weryfikacjƒÖ i obliczeniami."},
              {"type": "final", "content": "Tworzƒô szczeg√≥≈ÇowƒÖ odpowied≈∫ ≈ÇƒÖczƒÖcƒÖ biochemiƒô, r√≥wnania i dane ilo≈õciowe, przewy≈ºszajƒÖcƒÖ podstawowe informacje z RAG."}
            ]
          }
        },
        {
          "prompt": "Por√≥wnaj zalety i wady samochod√≥w elektrycznych i samochod√≥w benzynowych.",
          "llm": {
            "text": "Pojazdy elektryczne majƒÖ zazwyczaj ni≈ºsze koszty eksploatacji i zerowe emisje spalin, ale wy≈ºsze ceny zakupu i ograniczony zasiƒôg. Samochody benzynowe sƒÖ ta≈Ñsze w zakupie i tankujƒÖ szybciej przy wiƒôkszej infrastrukturze, ale majƒÖ emisje i wy≈ºsze koszty paliwa.",
            "tokens": 46,
            "latencyMs": 480,
            "costUsd": 0.00046
          },
          "reasoning": {
            "text": "Systematyczne por√≥wnanie:\n1.  **Koszt:** EV wy≈ºsze koszty poczƒÖtkowe, ni≈ºsze eksploatacyjne (paliwo/utrzymanie). Samochody benzynowe odwrotnie.\n2.  **≈örodowisko:** EV zerowe emisje spalin (ale wp≈Çyw produkcji baterii). Samochody benzynowe majƒÖ bezpo≈õrednie emisje.\n3.  **Wydajno≈õƒá/Wygoda:** EV ciche, szybkie przyspieszenie. Samochody benzynowe wiƒôkszy zasiƒôg, szybsze tankowanie.\n4.  **Infrastruktura:** Tankowanie benzyny powszechne. ≈Åadowanie EV ro≈õnie, ale mniej dostƒôpne.\n**Wniosek:** Wyb√≥r zale≈ºy od bud≈ºetu, potrzeb transportowych, priorytet√≥w ekologicznych i lokalnej infrastruktury.",
            "tokens": 85,
            "latencyMs": 700,
            "costUsd": 0.00080,
            "reasoningTrace": [
              "Cel: Por√≥wnaƒá pojazdy EV i benzynowe",
              "Metoda: Analiza zalet i wad",
              "Zdefiniuj kategorie: Koszt (Zakup, Eksploatacja), ≈örodowisko, Wydajno≈õƒá/Wygoda, Infrastruktura",
              "Analizuj EV: Wymie≈Ñ zalety/wady w ka≈ºdej kategorii",
              "Analizuj samochody benzynowe: Wymie≈Ñ zalety/wady w ka≈ºdej kategorii",
              "UporzƒÖdkuj wyniki: Prezentuj odkrycia kategoria po kategorii",
              "Synteza: Dodaj podsumowanie uwzglƒôdniajƒÖce kompromisy."
            ]
          },
          "rag": {
            "text": "Dostƒôp do wewnƒôtrznych raport√≥w rynkowych i technicznych:\nEV wykazujƒÖ ni≈ºszy TCO w ciƒÖgu 5 lat wed≈Çug naszej analizy [Dok: MktAnalys-Q1]. Emisje spalin sƒÖ zerowe, ale kluczowa jest ocena cyklu ≈ºycia baterii [Dok: TechAssess-EV7]. Samochody benzynowe zachowujƒÖ przewagƒô w szybko≈õci tankowania i poczƒÖtkowym koszcie, choƒá zmienno≈õƒá cen paliwa jest ryzykiem [Dok: MktAnalys-Q1].",
            "tokens": 68,
            "latencyMs": 820,
            "costUsd": 0.00080,
            "citations": [
              {
                "title": "Dokument wewnƒôtrzny: MktAnalys-Q1",
                "snippet": "Analiza rynku Q1 por√≥wnujƒÖca ca≈Çkowity koszt posiadania (TCO) pojazd√≥w EV i spalinowych...",
                "url": "#"
              },
              {
                "title": "Dokument wewnƒôtrzny: TechAssess-EV7",
                "snippet": "Dokument oceny technologicznej obejmujƒÖcy emisje w cyklu ≈ºycia baterii EV i recykling...",
                "url": "#"
              }
            ]
          },
          "agent": {
            "text": "**Szczeg√≥≈Çowa analiza por√≥wnawcza EV vs Benzynowe:**\n\n**üìä TCO (Total Cost of Ownership) - 5 lat:**\n‚Ä¢ EV: 165k PLN (zakup: 150k, energia: 15k)\n‚Ä¢ Benzynowe: 178k PLN (zakup: 90k, paliwo: 75k, serwis: 13k)\n**Oszczƒôdno≈õƒá EV: 13k PLN (7,3%)**\n\n**üåç Emisje CO‚ÇÇ (5 lat, 100k km):**\n‚Ä¢ EV: 8,4 tony (mix energetyczny PL)\n‚Ä¢ Benzynowe: 18,2 tony\n**Redukcja: 54% mniej emisji**\n\n**‚ö° Wydajno≈õƒá:**\n‚Ä¢ EV: ~85-90% efektywno≈õci energetycznej\n‚Ä¢ Benzynowe: ~20-30% efektywno≈õci\n\n**üîã Zasiƒôg i ≈Çadowanie:**\n‚Ä¢ EV: 350-500km, ≈Çadowanie 30-60min (DC)\n‚Ä¢ Benzynowe: 600-800km, tankowanie 5min\n\n**Rekomendacja:** EV op≈Çacalne dla >15k km/rok w mie≈õcie. Benzynowe dla czƒôstych d≈Çugich tras.",
            "tokens": 186,
            "latencyMs": 2100,
            "costUsd": 0.00195,
            "agentTrace": [
              {"type": "plan", "content": "Kompleksowa analiza: 1) Pobierz dane rynkowe, 2) Oblicz TCO na 5 lat, 3) Por√≥wnaj emisje CO‚ÇÇ, 4) Analizuj wydajno≈õƒá, 5) Weryfikuj dane, 6) Stw√≥rz macierz por√≥wnawczƒÖ, 7) Wygeneruj rekomendacje"},
              {"type": "toolcall", "content": "fetch_market_data(vehicle_type=\"EV\", market=\"Poland\", data=[\"avg_price\", \"energy_cost\", \"maintenance\"])"},
              {"type": "result", "content": "EV PL 2024: ≈örednia cena 150k PLN, koszt energii 0.75 PLN/kWh, serwis -40% vs benzynowe"},
              {"type": "toolcall", "content": "fetch_market_data(vehicle_type=\"ICE\", market=\"Poland\", data=[\"avg_price\", \"fuel_cost\", \"maintenance\"])"},
              {"type": "result", "content": "Benzynowe PL 2024: ≈örednia cena 90k PLN, paliwo 6.5 PLN/l, serwis standardowy"},
              {"type": "toolcall", "content": "calculate_tco(ev_data={price:150k, energy:15kWh/100km, cost:0.75}, ice_data={price:90k, fuel:7l/100km, cost:6.5}, years=5, km_per_year=20000)"},
              {"type": "result", "content": "TCO 5 lat/100k km: EV=165k PLN, ICE=178k PLN. Delta: -13k PLN (7.3% oszczƒôdno≈õci)"},
              {"type": "toolcall", "content": "emission_calculator(ev_kwh_per_km=0.15, ice_l_per_km=0.07, km=100000, grid_mix=\"Poland\")"},
              {"type": "result", "content": "Emisje 100k km: EV=8.4t CO‚ÇÇ (wliczajƒÖc produkcjƒô energii PL), ICE=18.2t CO‚ÇÇ. Redukcja: 54%"},
              {"type": "toolcall", "content": "efficiency_analyzer(ev_motor_eff=0.9, ice_engine_eff=0.25)"},
              {"type": "result", "content": "Efektywno≈õƒá: EV 85-90% (strata na ≈Çadowanie/roz≈Çadowanie), ICE 20-30% (ciep≈Ço, tarcie)"},
              {"type": "toolcall", "content": "validate_calculations(tco_delta=-13000, emission_reduction=0.54, check_sources=true)"},
              {"type": "result", "content": "Walidacja ‚úì: Obliczenia zgodne z MktAnalys-Q1 i TechAssess-EV7. ≈πr√≥d≈Ça zweryfikowane."},
              {"type": "reflection", "content": "Przeprowadzi≈Çem kompleksowƒÖ analizƒô z 6 narzƒôdziami: pobra≈Çem aktualne dane rynkowe PL, obliczy≈Çem TCO, emisje i efektywno≈õƒá, zweryfikowa≈Çem wyniki. RAG poda≈Ç tylko og√≥lne stwierdzenia - ja dostarczam konkretne liczby i ROI."},
              {"type": "final", "content": "Tworzƒô rekomendacjƒô opartƒÖ na danych: TCO, emisjach i profilu u≈ºytkowania. Odpowied≈∫ przewy≈ºsza RAG analizƒÖ ilo≈õciowƒÖ i kontekstem lokalnym (PL)."}
            ]
          }
        },
         {
          "prompt": "Jaka jest polityka firmy dotyczƒÖca pracy zdalnej?",
          "llm": {
            "text": "Polityka pracy zdalnej w firmach zazwyczaj okre≈õla kryteria kwalifikacji, oczekiwania dotyczƒÖce komunikacji i wydajno≈õci, wymagania dotyczƒÖce domowego biura oraz ograniczenia lokalizacji. Nale≈ºy zazwyczaj zapoznaƒá siƒô z oficjalnym podrƒôcznikiem HR lub dokumentami polityki w celu uzyskania szczeg√≥≈Ç√≥w.",
            "tokens": 43,
            "latencyMs": 450,
            "costUsd": 0.00043
          },
          "reasoning": {
            "text": "Aby okre≈õliƒá politykƒô pracy zdalnej:\n1.  **Zakres:** Polityka dotyczy pracownik√≥w pe≈Çnoetatowych.\n2.  **Kwalifikacje:** Wymaga zgody mened≈ºera i odpowiednio≈õci stanowiska (zdefiniowana lista).\n3.  **Wymagania:** Nale≈ºy zachowaƒá podstawowe godziny pracy (10:00-16:00 czasu lokalnego), bezpieczny internet, dedykowane miejsce pracy.\n4.  **Lokalizacja:** Nale≈ºy przebywaƒá w zatwierdzonych krajach/stanach.\n**Podsumowanie:** Uprawnieni pracownicy mogƒÖ pracowaƒá zdalnie za zgodƒÖ mened≈ºera, z zastrze≈ºeniem okre≈õlonego stanowiska, konfiguracji i wymaga≈Ñ lokalizacyjnych.",
            "tokens": 75,
            "latencyMs": 680,
            "costUsd": 0.00070,
            "reasoningTrace": [
              "Cel: Okre≈õliƒá politykƒô pracy zdalnej firmy",
              "≈πr√≥d≈Ço informacji: Zak≈Çadaj dostƒôp do wewnƒôtrznych zasad/logiki HR.",
              "Krok 1: Okre≈õl, do kogo odnosi siƒô polityka (np. typy pracownik√≥w).",
              "Krok 2: Okre≈õl kryteria kwalifikacji (np. typ stanowiska, zgoda mened≈ºera).",
              "Krok 3: Zidentyfikuj wymagania operacyjne (np. godziny, sprzƒôt, ≈ÇƒÖczno≈õƒá).",
              "Krok 4: Sprawd≈∫ ograniczenia (np. ograniczenia geograficzne).",
              "Krok 5: Zsyntetyzuj odkrycia w uporzƒÖdkowane podsumowanie polityki."
            ]
          },
          "rag": {
            "text": "Sprawdzam oficjalne dokumenty HR:\nPolityka pracy zdalnej [Dok: HRManual-Sec4.B] stwierdza, ≈ºe kwalifikacja wymaga zgody mened≈ºera i odpowiednio≈õci stanowiska. Pracownicy muszƒÖ utrzymywaƒá wyznaczone miejsce pracy i przestrzegaƒá protoko≈Ç√≥w bezpiecze≈Ñstwa okre≈õlonych w [Dok: RemoteGuide-v3]. Pe≈Çne szczeg√≥≈Çy znajdujƒÖ siƒô w Podrƒôczniku HR.",
            "tokens": 55,
            "latencyMs": 750,
            "costUsd": 0.00075,
            "citations": [
              {
                "title": "Dokument wewnƒôtrzny: HRManual-Sec4.B",
                "snippet": "Sekcja 4.B: Polityka pracy zdalnej, w tym kwalifikacje, proces sk≈Çadania wniosk√≥w i obowiƒÖzki mened≈ºera...",
                "url": "#"
              },
              {
                "title": "Dokument wewnƒôtrzny: RemoteGuide-v3",
                "snippet": "Wersja 3 Wytycznych pracy zdalnej, szczeg√≥≈Çowo opisujƒÖca wymagania dotyczƒÖce miejsca pracy, protoko≈Çy bezpiecze≈Ñstwa i oczekiwania komunikacyjne...",
                "url": "#"
              }
            ]
          },
          "agent": {
            "text": "**Kompletna Polityka Pracy Zdalnej - Analiza dokument√≥w HR:**\n\n**‚úÖ Kwalifikacje (HRManual-Sec4.B ¬ß2.1):**\n‚Ä¢ Pracownicy pe≈Çnoetatowi z min. 6 mies. sta≈ºem\n‚Ä¢ Stanowiska kwalifikowane: IT, Marketing, Finanse, HR (88% zespo≈Çu)\n‚Ä¢ Wymagana zgoda bezpo≈õredniego prze≈Ço≈ºonego\n‚Ä¢ Pozytywna ocena roczna (min. \"spe≈Çnia oczekiwania\")\n\n**üîß Wymagania techniczne (RemoteGuide-v3 ¬ß3):**\n‚Ä¢ Internet: min. 50 Mbps download, 10 Mbps upload\n‚Ä¢ Sprzƒôt: laptop firmowy + monitor (dostarczone przez IT)\n‚Ä¢ VPN: obowiƒÖzkowe po≈ÇƒÖczenie przez Cisco AnyConnect\n‚Ä¢ Backup: hotspot mobilny jako zabezpieczenie\n\n**‚è∞ Godziny pracy:**\n‚Ä¢ Core hours: 10:00-16:00 (strefa CET) - obowiƒÖzkowa dostƒôpno≈õƒá\n‚Ä¢ Flextime: pozosta≈Çe 2h w oknie 7:00-20:00\n‚Ä¢ Overlap z zespo≈Çem: min. 6h dziennie\n\n**üåç Lokalizacja (Compliance ¬ß4.2):**\n‚Ä¢ Dozwolone: PL, DE, NL, CZ (weryfikacja podatkowa)\n‚Ä¢ Wymaga zgody Legal: pozosta≈Çe kraje UE\n‚Ä¢ Zakazane: spoza UE (RODO, compliance)\n\n**üìã Proces wnioskowania:**\n1. Formularz WFH-01 ‚Üí Manager (3 dni)\n2. Akceptacja ‚Üí IT setup (5 dni)\n3. Training bezpiecze≈Ñstwa (2h online)\n4. Trial period: 3 miesiƒÖce\n\n**Status: 67% zespo≈Çu pracuje zdalnie (dane Q4 2024)**",
            "tokens": 248,
            "latencyMs": 2350,
            "costUsd": 0.00260,
            "agentTrace": [
              {"type": "plan", "content": "Kompleksowa analiza dokument√≥w HR: 1) Parsuj HRManual-Sec4.B, 2) Parsuj RemoteGuide-v3, 3) Cross-reference z Compliance, 4) Wyodrƒôbnij kluczowe ¬ß, 5) Sprawd≈∫ aktualno≈õƒá, 6) Dodaj statystyki, 7) Weryfikuj sp√≥jno≈õƒá polityk"},
              {"type": "toolcall", "content": "document_parser(doc_id=\"HRManual-Sec4.B\", extract=[\"eligibility\", \"process\", \"requirements\"], version=\"latest\")"},
              {"type": "result", "content": "HRManual-Sec4.B v2.3 (2024-09): Kwalifikacje ¬ß2.1: pe≈Çny etat, 6 mies. sta≈º, zgoda managera, pozytywna ocena. Stanowiska: IT, Marketing, Finanse, HR"},
              {"type": "toolcall", "content": "document_parser(doc_id=\"RemoteGuide-v3\", extract=[\"technical_req\", \"core_hours\", \"equipment\"], version=\"latest\")"},
              {"type": "result", "content": "RemoteGuide-v3 ¬ß3: Internet 50/10 Mbps, VPN Cisco, laptop+monitor firmowy, core hours 10-16 CET, backup hotspot"},
              {"type": "toolcall", "content": "cross_reference_check(docs=[\"HRManual-Sec4.B\", \"RemoteGuide-v3\", \"CompliancePolicy\"], field=\"location_restrictions\")"},
              {"type": "result", "content": "Compliance ¬ß4.2: Dozwolone PL,DE,NL,CZ bez dodatkowej zgody. Pozosta≈Çe UE: zgoda Legal. Spoza UE: zakazane (RODO)"},
              {"type": "toolcall", "content": "extract_process_flow(doc=\"HRManual-Sec4.B\", section=\"application\")"},
              {"type": "result", "content": "Proces: WFH-01 form ‚Üí Manager approval (3d) ‚Üí IT setup (5d) ‚Üí Security training (2h) ‚Üí Trial 3m"},
              {"type": "toolcall", "content": "get_statistics(metric=\"remote_work_adoption\", timeframe=\"Q4_2024\", department=\"all\")"},
              {"type": "result", "content": "Statystyki Q4 2024: 67% pracownik√≥w pracuje zdalnie (pe≈Çny/hybrydowy), wzrost o 12% r/r"},
              {"type": "toolcall", "content": "policy_validator(policies=[\"HRManual-Sec4.B\", \"RemoteGuide-v3\"], check_conflicts=true, check_outdated=true)"},
              {"type": "result", "content": "Walidacja ‚úì: Brak konflikt√≥w miƒôdzy politykami. Wszystkie dokumenty aktualne (ostatnia rewizja: 09.2024)"},
              {"type": "reflection", "content": "Przeanalizowa≈Çem 3 dokumenty u≈ºywajƒÖc 6 narzƒôdzi: sparsowa≈Çem kluczowe sekcje, sprawdzi≈Çem cross-reference dla lokalizacji, wydoby≈Çem proces aplikacji, doda≈Çem aktualne statystyki i zwalidowa≈Çem sp√≥jno≈õƒá. RAG poda≈Ç tylko og√≥lne info - ja dostarczam konkretne paragrafy, wymagania techniczne, proces i dane ilo≈õciowe."},
              {"type": "final", "content": "Tworzƒô strukturalnƒÖ odpowied≈∫ z referencjami do konkretnych ¬ß, pe≈Çnym procesem wnioskowania i kontekstem statystycznym - przewy≈ºsza RAG g≈Çƒôboko≈õciƒÖ i praktycznymi szczeg√≥≈Çami."}
            ]
          }
        }
      ],
      "defaultAnswer": {
        "text": "Nie mam konkretnych symulowanych danych dla tego zapytania. Proszƒô wybraƒá jedno z przyk≈Çadowych zapyta≈Ñ, aby zobaczyƒá por√≥wnanie.",
        "tokens": 21,
        "latencyMs": 300,
        "costUsd": 0.00015
      }
    }
    </script>

    <script>
        // --- DOM Element References ---
        // Get references to necessary HTML elements
        const qData = JSON.parse(document.getElementById('questionData').textContent); // Parse the corrected JSON
        const promptInput = document.getElementById('promptInput');
        const sendBtn = document.getElementById('sendBtn');
        const chatContainer = document.getElementById('chatContainer');
        const alertBox = document.getElementById('alert');
        const promptSelect = document.getElementById('promptSelect');

        // --- Paradigm Definitions with Icons and Descriptions ---
        // Define the different chatbot types to simulate
        const paradigms = [
            {
                key: 'llm',
                label: 'Chat LLM',
                color: 'bg-white', // Background color class
                iconSvg: `<svg class="inline-icon w-5 h-5 text-purple-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 0 0 2.25-2.25V8.25a2.25 2.25 0 0 0-2.25-2.25H6.75A2.25 2.25 0 0 0 4.5 8.25v10.5A2.25 2.25 0 0 0 6.75 21H9" /></svg>`,
                description: 'Generuje tekst bezpo≈õrednio z obszernych danych treningowych.'
            },
            {
                key: 'reasoning',
                label: 'Chat z rozumowaniem',
                color: 'bg-green-50',
                iconSvg: `<svg class="inline-icon w-5 h-5 text-green-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.43.992a6.759 6.759 0 0 1 0 1.903c.008.378.137.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.6 6.6 0 0 1-.22.128c-.332.183-.582.495-.644.869l-.213 1.28c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.759 6.759 0 0 1 0-1.903c-.007-.378-.137-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582.495.644-.869l.214-1.28Z" /></svg>`,
                description: 'Wykorzystuje wewnƒôtrzne kroki logiczne lub planowanie przed odpowiedziƒÖ.'
            },
            {
                key: 'rag',
                label: 'Chat RAG',
                color: 'bg-blue-50',
                iconSvg: `<svg class="inline-icon w-5 h-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607ZM10.5 7.5v6m3-3h-6" /></svg>`,
                description: 'Najpierw wyszukuje informacje ze zdefiniowanej bazy wiedzy.'
            },
            {
                key: 'agent',
                label: 'Chat Agent',
                color: 'bg-orange-50',
                iconSvg: `<svg class="inline-icon w-5 h-5 text-orange-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17 17.25 21A2.652 2.652 0 0 0 21 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 1 1-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 0 0 4.486-6.336l-3.276 3.277a3.004 3.004 0 0 1-2.25-2.25l3.276-3.276a4.5 4.5 0 0 0-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437 1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008Z" /></svg>`,
                description: 'Wykorzystuje narzƒôdzia i przechodzi przez etapy: plan, akcja, refleksja.'
            }
        ];

        // --- Function to Populate Sample Prompts Dropdown ---
        function populatePrompts() {
            // Clear existing options before adding new ones
            promptSelect.innerHTML = '';
            // Create and add a placeholder option
            const placeholderOption = document.createElement('option');
            placeholderOption.textContent = '-- Wybierz przyk≈Çadowe zapytanie --';
            placeholderOption.value = ""; // Empty value for placeholder
            placeholderOption.disabled = true;
            placeholderOption.selected = true;
            promptSelect.appendChild(placeholderOption);

            // Add an option for each question in the data
            qData.questions.forEach(q => {
                const option = document.createElement('option');
                option.value = q.prompt; // Set the value to the prompt text
                option.textContent = q.prompt; // Set the display text
                promptSelect.appendChild(option);
            });
            console.log("Prompts populated."); // Debug log
        }


        // --- Function to Create an Individual Chat Pane ---
        function createPane(paradigm) {
            const paneDiv = document.createElement('div');
            // Apply styling for the chat pane using Tailwind classes
            paneDiv.className = `${paradigm.color} p-4 rounded-lg shadow-md flex flex-col border border-gray-200 min-h-[300px]`;
            // Set inner HTML structure for the pane (header, output area, metrics area)
            paneDiv.innerHTML = `
                <div class="flex-shrink-0"> <h2 class="font-semibold mb-1 text-lg text-gray-800">${paradigm.iconSvg}${paradigm.label}</h2>
                    <p class="text-xs text-gray-600 mb-3">${paradigm.description}</p>
                </div>
                <div class="flex-grow overflow-y-auto text-gray-700 leading-relaxed mb-2" data-output></div> <div class="flex-shrink-0 text-xs text-gray-500 mt-auto border-t border-gray-200 pt-2" data-metrics></div> `;
            return paneDiv;
        }

        // --- Function to Render Typing Output ---
        function renderOutput(outputContainer, answerData, mode) {
            outputContainer.textContent = ''; // Clear previous content
            // Split text carefully by newline, bold markdown, or LaTeX, preserving delimiters
            const segments = answerData.text.split(/(\n|\*\*.*?\*\*|\$.*?\$)/).filter(Boolean);
            let segmentIndex = 0;
            const span = document.createElement('span'); // Use a span for the typing effect
            outputContainer.appendChild(span);
            span.classList.add('typing'); // Add typing cursor class

            // Calculate delay per segment for the typing animation
            const totalDuration = answerData.latencyMs * 0.7; // Use 70% of latency for typing effect
            const delayPerSegment = Math.max(30, totalDuration / Math.max(segments.length, 1)); // Minimum 30ms delay

            // Interval timer to append segments one by one
            const intervalId = setInterval(() => {
                if (segmentIndex < segments.length) {
                    let currentSegment = segments[segmentIndex];
                    // Handle different segment types (newline, bold, LaTeX, plain text)
                    if (currentSegment === '\n') {
                        span.innerHTML += '<br>';
                    } else if (currentSegment.startsWith('**') && currentSegment.endsWith('**')) {
                        span.innerHTML += `<strong>${currentSegment.slice(2, -2)}</strong>`; // Render bold
                    } else if (currentSegment.startsWith('$') && currentSegment.endsWith('$')) {
                        span.innerHTML += currentSegment; // Keep LaTeX as is for MathJax
                    } else {
                        span.textContent += currentSegment; // Append regular text
                    }
                    segmentIndex++;
                } else {
                    // Typing finished
                    span.classList.remove('typing'); // Remove typing cursor
                    clearInterval(intervalId); // Stop the interval

                    // Add reasoning or citations sections *after* typing finishes
                    // These are added to the parent container of the output div
                    if (mode === 'reasoning' && answerData.reasoningTrace) {
                        addReasoning(outputContainer.parentNode, answerData.reasoningTrace);
                    }
                    if (mode === 'rag' && answerData.citations) {
                        addCitations(outputContainer.parentNode, answerData.citations);
                    }
                    if (mode === 'agent' && answerData.agentTrace) {
                        addAgentTrace(outputContainer.parentNode, answerData.agentTrace);
                    }

                    // Trigger MathJax typesetting if available
                    if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
                        MathJax.typesetPromise([outputContainer]).catch(function (err) {
                           console.error('MathJax typesetting error:', err); // Log errors
                        });
                    }
                }
            }, delayPerSegment);
        }


        // --- Function to Add Reasoning Steps Section ---
        function addReasoning(container, trace) {
            // Remove existing reasoning section first to prevent duplicates
            const existingDetails = container.querySelector('.reasoning-details');
            if (existingDetails) existingDetails.remove();

            // Create details/summary element for accordion effect
            const details = document.createElement('details');
            details.className = 'reasoning-details mt-3 text-sm border-t border-green-200 pt-2 bg-green-50 p-3 rounded'; // Styling
            // Summary text with an icon
            details.innerHTML = '<summary class="font-medium text-green-800 cursor-pointer text-base mb-1 flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z" /></svg>Kroki rozumowania</summary>';
            // Create ordered list for the steps
            const list = document.createElement('ol');
            list.className = 'list-decimal list-inside text-green-900 mt-1 space-y-1 pl-2';
            trace.forEach(step => {
                const item = document.createElement('li');
                item.innerHTML = step.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); // Support bold markdown in steps
                list.appendChild(item);
            });
            details.appendChild(list);
            // Insert the reasoning section before the metrics div
            container.insertBefore(details, container.querySelector('[data-metrics]'));
        }

        // --- Function to Add Citations Section ---
        function addCitations(container, citations) {
             // Remove existing citation section first
            const existingCitations = container.querySelector('.citation-section');
            if (existingCitations) existingCitations.remove();

            // Create div for the citation section
            const citationDiv = document.createElement('div');
            citationDiv.className = 'citation-section mt-3 space-y-2 text-xs border-t border-blue-200 pt-2 bg-blue-50 p-3 rounded'; // Styling
            // Title with an icon
            const title = document.createElement('h4');
            title.className = 'font-medium text-blue-800 mb-2 text-sm flex items-center gap-1';
            title.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" /></svg>Bibliografia';
            citationDiv.appendChild(title);

            // Add each citation as a paragraph
            citations.forEach(cit => {
                const p = document.createElement('p');
                p.className = 'text-blue-900';
                // Format citation with title, snippet, and link
                p.innerHTML = `<span class="font-semibold">${cit.title}:</span> "${cit.snippet}" <a href="${cit.url || '#'}" target="_blank" rel="noopener noreferrer" class="text-blue-600 underline hover:text-blue-800">[Link]</a>`;
                citationDiv.appendChild(p);
            });
             // Insert the citation section before the metrics div
            container.insertBefore(citationDiv, container.querySelector('[data-metrics]'));
        }

        // --- Function to Add Agent Trace Section ---
        function addAgentTrace(container, trace) {
            // Remove existing agent trace section first
            const existingTrace = container.querySelector('.agent-trace-section');
            if (existingTrace) existingTrace.remove();

            // Create details/summary element for accordion effect
            const details = document.createElement('details');
            details.className = 'agent-trace-section mt-3 text-sm border-t border-orange-200 pt-2 bg-orange-50 p-3 rounded';
            // Summary text with an icon
            details.innerHTML = '<summary class="font-medium text-orange-800 cursor-pointer text-base mb-1 flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.43.992a6.759 6.759 0 0 1 0 1.903c.008.378.137.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.6 6.6 0 0 1-.22.128c-.332.183-.582.495-.644.869l-.213 1.28c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.759 6.759 0 0 1 0-1.903c-.007-.378-.137-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582.495.644-.869l.214-1.28Z" /></svg>≈ölad wykonania agenta</summary>';

            // Create list for the steps
            const list = document.createElement('div');
            list.className = 'space-y-2 mt-2';

            // Define icons and labels for each step type
            const typeConfig = {
                'plan': { icon: 'üìã', label: 'Plan', color: 'text-orange-900 bg-orange-100', border: 'border-orange-300' },
                'toolcall': { icon: 'üîß', label: 'Wywo≈Çanie narzƒôdzia', color: 'text-blue-900 bg-blue-100', border: 'border-blue-300' },
                'result': { icon: '‚úì', label: 'Wynik', color: 'text-green-900 bg-green-100', border: 'border-green-300' },
                'reflection': { icon: 'üí≠', label: 'Refleksja', color: 'text-purple-900 bg-purple-100', border: 'border-purple-300' },
                'final': { icon: 'üéØ', label: 'Finalizacja', color: 'text-red-900 bg-red-100', border: 'border-red-300' }
            };

            trace.forEach(step => {
                const config = typeConfig[step.type] || { icon: '‚Ä¢', label: step.type, color: 'text-gray-900 bg-gray-100', border: 'border-gray-300' };
                const stepDiv = document.createElement('div');
                stepDiv.className = `p-2 rounded border ${config.border} ${config.color}`;
                stepDiv.innerHTML = `<div class="font-semibold text-xs mb-1">${config.icon} ${config.label}</div><div class="text-xs">${step.content}</div>`;
                list.appendChild(stepDiv);
            });

            details.appendChild(list);
            // Insert the agent trace section before the metrics div
            container.insertBefore(details, container.querySelector('[data-metrics]'));
        }


        // --- Function to Render Metrics ---
        function renderMetrics(metricsContainer, answerData) {
            // Display tokens, latency, and estimated cost
            metricsContainer.textContent = `Tokeny: ${answerData.tokens} | Op√≥≈∫nienie: ${answerData.latencyMs} ms | Szac. koszt: $${answerData.costUsd.toFixed(5)}`;
        }

        // --- Main Function to Handle Sending Prompt ---
        function send() {
            console.log("Send function triggered."); // Debug log
            const promptText = promptInput.value.trim();
            // Check if prompt is empty
            if (!promptText) {
                alertBox.textContent = 'Proszƒô wprowadziƒá zapytanie lub wybraƒá przyk≈Çad.';
                alertBox.classList.remove('hidden'); // Show alert
                // Ensure alert is red for error
                alertBox.classList.remove('bg-yellow-100', 'text-yellow-800', 'border-yellow-300');
                alertBox.classList.add('bg-red-100', 'text-red-700', 'border-red-300');
                return;
            }

            // Find matching question data (case-insensitive comparison)
            const exactMatch = qData.questions.find(q => q.prompt.toLowerCase() === promptText.toLowerCase());
            const usingDefault = !exactMatch; // Flag if using default answer
            // Use matched data or the default answer structure
            const dataToShow = exactMatch || {
                llm: qData.defaultAnswer,
                reasoning: qData.defaultAnswer,
                rag: qData.defaultAnswer
            };

            // Clear previous results and hide any existing alert
            chatContainer.innerHTML = '';
            alertBox.classList.add('hidden');

            // Show informational alert if using the default answer set
            if (usingDefault) {
                alertBox.textContent = 'Zapytanie nie znalezione w przyk≈Çadach - pokazujƒô domy≈õlnƒÖ symulacjƒô odpowiedzi.';
                alertBox.classList.remove('hidden');
                // Style alert as informational (yellow)
                alertBox.classList.remove('bg-red-100', 'text-red-700', 'border-red-300');
                alertBox.classList.add('bg-yellow-100', 'text-yellow-800', 'border-yellow-300');
            }

            // Create and populate panes for each defined paradigm
            paradigms.forEach(paradigm => {
                const pane = createPane(paradigm); // Create the pane structure
                chatContainer.appendChild(pane); // Add pane to the grid

                // Get references to the output and metrics divs within the new pane
                const outputDiv = pane.querySelector('[data-output]');
                const metricsDiv = pane.querySelector('[data-metrics]');
                // Get the specific answer data for this paradigm
                const answer = dataToShow[paradigm.key];

                // Use setTimeout to allow the UI to update before starting animation/metrics rendering
                // This prevents the UI from freezing briefly on potentially slow operations
                setTimeout(() => {
                    renderOutput(outputDiv, answer, paradigm.key); // Start typing animation
                    renderMetrics(metricsDiv, answer); // Display metrics
                }, 50); // Small delay (50ms)
            });

            // Reset dropdown selection if a custom prompt was entered that wasn't a sample
            if (promptSelect.value.toLowerCase() !== promptText.toLowerCase()) {
                 if(promptSelect.options.length > 0) { // Check if options exist
                    promptSelect.selectedIndex = 0; // Reset to the placeholder option
                 }
            }
        }

        // --- Event Listeners for User Interaction ---

        // Send button click
        sendBtn.addEventListener('click', send);

        // Enter key press in the input field
        promptInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault(); // Prevent default form submission if applicable
                send();
            }
        });

        // Sample Prompt Selection Change
         promptSelect.addEventListener('change', () => {
            console.log("Dropdown changed. Selected value:", promptSelect.value); // Debug log
            if (promptSelect.value) { // Only proceed if a valid (non-placeholder) option is selected
                promptInput.value = promptSelect.value; // Update the text input
                promptInput.focus(); // Focus the text input
                send(); // Automatically send the selected prompt
            }
        });


        // --- Initialization ---
        // Populate the prompts dropdown immediately when the script runs
        populatePrompts();

    </script>
</body>
</html>
